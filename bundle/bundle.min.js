"use strict";var ie=Object.defineProperty,ne=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var X=e=>{throw TypeError(e)};var D=(e,t,s)=>t in e?ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,M=(e,t)=>{for(var s in t||(t={}))oe.call(t,s)&&D(e,s,t[s]);if(J)for(var s of J(t))le.call(t,s)&&D(e,s,t[s]);return e},z=(e,t)=>ne(e,ae(t));var j=(e,t,s)=>D(e,typeof t!="symbol"?t+"":t,s),H=(e,t,s)=>t.has(e)||X("Cannot "+s);var f=(e,t,s)=>(H(e,t,"read from private field"),s?s.call(e):t.get(e)),v=(e,t,s)=>t.has(e)?X("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),y=(e,t,s,n)=>(H(e,t,"write to private field"),n?n.call(e,s):t.set(e,s),s),E=(e,t,s)=>(H(e,t,"access private method"),s);var Q=(e,t,s,n)=>({set _(r){y(e,t,r,s)},get _(){return f(e,t,n)}});var __create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),__typeError=e=>{throw TypeError(e)},__defNormalProp=(e,t,s)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,__name=(e,t)=>__defProp(e,"name",{value:t,configurable:!0}),__esm=(e,t)=>function(){return e&&(t=(0,e[__getOwnPropNames(e)[0]])(e=0)),t},__commonJS=(e,t)=>function(){return t||(0,e[__getOwnPropNames(e)[0]])((t={exports:{}}).exports,t),t.exports},__export=(e,t)=>{for(var s in t)__defProp(e,s,{get:t[s],enumerable:!0})},__copyProps=(e,t,s,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of __getOwnPropNames(t))!__hasOwnProp.call(e,r)&&r!==s&&__defProp(e,r,{get:()=>t[r],enumerable:!(n=__getOwnPropDesc(t,r))||n.enumerable});return e},__toCommonJS=e=>__copyProps(__defProp({},"__esModule",{value:!0}),e),__decoratorStart=e=>{var t;return[,,,__create((t=e==null?void 0:e[__knownSymbol("metadata")])!=null?t:null)]},__decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=e=>e!==void 0&&typeof e!="function"?__typeError("Function expected"):e,__decoratorContext=(e,t,s,n,r)=>({kind:__decoratorStrings[e],name:t,metadata:n,addInitializer:i=>s._?__typeError("Already initialized"):r.push(__expectFn(i||null))}),__decoratorMetadata=(e,t)=>__defNormalProp(t,__knownSymbol("metadata"),e[3]),__runInitializers=(e,t,s,n)=>{for(var r=0,i=e[t>>1],o=i&&i.length;r<o;r++)t&1?i[r].call(s):n=i[r].call(s,n);return n},__decorateElement=(e,t,s,n,r,i)=>{var o,h,c,p,l,a=t&7,u=!!(t&8),d=!!(t&16),g=a>3?e.length+1:a?u?1:2:0,_=__decoratorStrings[a+5],T=a>3&&(e[g-1]=[]),N=e[g]||(e[g]=[]),b=a&&(!d&&!u&&(r=r.prototype),a<5&&(a>3||!d)&&__getOwnPropDesc(a<4?r:{get[s](){return __privateGet(this,i)},set[s](m){return __privateSet(this,i,m)}},s));a?d&&a<4&&__name(i,(a>2?"set ":a>1?"get ":"")+s):__name(r,s);for(var x=n.length-1;x>=0;x--)p=__decoratorContext(a,s,c={},e[3],N),a&&(p.static=u,p.private=d,l=p.access={has:d?m=>__privateIn(r,m):m=>s in m},a^3&&(l.get=d?m=>(a^1?__privateGet:__privateMethod)(m,r,a^4?i:b.get):m=>m[s]),a>2&&(l.set=d?(m,A)=>__privateSet(m,r,A,a^4?i:b.set):(m,A)=>m[s]=A)),h=(0,n[x])(a?a<4?d?i:b[_]:a>4?void 0:{get:b.get,set:b.set}:r,p),c._=1,a^4||h===void 0?__expectFn(h)&&(a>4?T.unshift(h):a?d?i=h:b[_]=h:r=h):typeof h!="object"||h===null?__typeError("Object expected"):(__expectFn(o=h.get)&&(b.get=o),__expectFn(o=h.set)&&(b.set=o),__expectFn(o=h.init)&&T.unshift(o));return a||__decoratorMetadata(e,r),b&&__defProp(r,s,b),d?a^4?i:b:r},__accessCheck=(e,t,s)=>t.has(e)||__typeError("Cannot "+s),__privateIn=(e,t)=>Object(t)!==t?__typeError('Cannot use the "in" operator on this value'):e.has(t),__privateGet=(e,t,s)=>(__accessCheck(e,t,"read from private field"),s?s.call(e):t.get(e)),__privateSet=(e,t,s,n)=>(__accessCheck(e,t,"write to private field"),n?n.call(e,s):t.set(e,s),s),__privateMethod=(e,t,s)=>(__accessCheck(e,t,"access private method"),s),Shadow,setChildNodes,getMagicWordInfo,init_debug=__esm({"util/debug.ts"(){"use strict";Shadow={run(e,t){return e()}},setChildNodes=(e,t,s,n=[])=>{var o,h;let r=e.getChildNodes(),i;r.length===s?(i=r,r=n):i=Array.prototype.splice.apply(r,[t,s,...n]);for(let c=0;c<n.length;c++){const p=n[c];p.setAttribute("parentNode",e),p.setAttribute("nextSibling",r[t+c+1]),p.setAttribute("previousSibling",r[t+c-1])}return(o=r[t-1])==null||o.setAttribute("nextSibling",r[t]),(h=r[t+n.length])==null||h.setAttribute("previousSibling",r[t+n.length-1]),r===n&&e.setAttribute("childNodes",r),i},getMagicWordInfo=(e,t)=>{const s=e.toLowerCase(),[n,r]=t,i=Object.prototype.hasOwnProperty.call(r,e);return[s,i,i?r[e]:Object.prototype.hasOwnProperty.call(n,s)&&n[s]]}}}),require_minimum=__commonJS({"config/minimum.json"(e,t){t.exports={ext:[],namespaces:{0:"",6:"File",10:"Template"},nsid:{"":0,file:6,template:10},functionHook:[],variable:["!","="],parserFunction:[{},{"!":"!","=":"="},["msg","raw"],["subst","safesubst"]]}}}),MAX_STAGE,minConfig,init_constants=__esm({"util/constants.ts"(){"use strict";MAX_STAGE=2,minConfig=require_minimum()}});function restore(e,t){return e.replace(/\0(\d+)\x7F/gu,(s,n)=>t[n])}var trimLc,factory,tidy,removeComment,text,names,decodeHtmlBasic,decodeHtmlResolved,decodeHtml,init_string=__esm({"util/string.ts"(){"use strict";trimLc=e=>e.trim().toLowerCase(),factory=(e,t)=>s=>s.replace(e,t),tidy=factory(/[\0\x7F]|\r$/gmu,""),removeComment=factory(/\0\d+[cn]\x7F/gu,""),text=(e,t="")=>e.map(s=>typeof s=="string"?s:s.text()).join(t),names={lt:"<",gt:">",lbrack:"[",rbrack:"]",lbrace:"{",rbrace:"}",nbsp:" ",amp:"&",quot:'"'},decodeHtmlBasic=factory(/&(?:#(\d+|[Xx][\da-fA-F]+)|([lg]t|[LG]T|[lr]brac[ke]|nbsp|amp|AMP|quot|QUOT));/gu,(e,t,s)=>t?String.fromCodePoint(+((/^x/iu.test(t)?"0":"")+t)):names[s.toLowerCase()]),decodeHtml=e=>(decodeHtmlResolved!=null||(decodeHtmlResolved=decodeHtmlBasic),decodeHtmlResolved(e))}});function getRegex(e){const t=new Map,s=new WeakMap;return n=>{const r=typeof n=="string"?t:s;if(r.has(n)){const o=r.get(n);return o.lastIndex=0,o}const i=e(n);return r.set(n,i),i}}var rawurldecode,init_dist=__esm({"../common/dist/index.mjs"(){"use strict";rawurldecode=e=>decodeURIComponent(e.replace(/%(?![\da-f]{2})/giu,"%25"))}}),resolve,Title,init_title=__esm({"lib/title.ts"(){"use strict";var e,t,s,n,K,i;init_dist(),init_string(),resolve=o=>{const[,{length:h},c]=/^((?:\.\.\/)*)([\s\S]*)/u.exec(o);return[h/3,c]},Title=(i=class{constructor(o,h,c,{temporary:p,decode:l,selfLink:a,page:u}={}){v(this,n);v(this,e);v(this,t);v(this,s);j(this,"valid");const d=o.trim(),g=d.startsWith("../");if(l&&o.includes("%"))try{o=rawurldecode(o)}catch(b){}if(o=decodeHtml(o).replace(/[_ ]+/gu," ").trim(),g)y(this,s,0);else{let b=h;o.startsWith(":")&&(b=0,o=o.slice(1).trim());const x=o.split(":");if(x.length>1){const m=trimLc(x[0]),A=Object.prototype.hasOwnProperty.call(c.nsid,m)&&c.nsid[m];A&&(b=A,o=x.slice(1).join(":").trim())}y(this,s,b)}const _=o.indexOf("#");_!==-1&&(o=o.slice(0,_).trim());const[T,N]=g?resolve(o):[0,o];this.valid=!!o&&decodeHtml(o)===o&&!/^:|\0\d+[eh!+-]\x7F|[<>[\]{}|\n]|%[\da-f]{2}|(?:^|\/)\.{1,2}(?:$|\/)/iu.test(N),this.main=o,y(this,t,c.namespaces)}get ns(){return f(this,s)}get main(){return f(this,e)}set main(o){o=o.replace(/_/gu," ").trim(),y(this,e,o&&o[0].toUpperCase()+o.slice(1))}get prefix(){const o=f(this,t)[this.ns];return o+(o&&":")}get title(){return this.getRedirection()[1]}getRedirection(){const{prefix:o}=this,h=o;return E(this,n,K).call(this,h)}},e=new WeakMap,t=new WeakMap,s=new WeakMap,n=new WeakSet,K=function(o){let h=(o+this.main).replace(/ /gu,"_");return h.startsWith("/")&&(h=h.replace(/(.)\/$/u,"$1")),[!1,h]},i)}}),nodeLike,init_nodeLike=__esm({"mixin/nodeLike.ts"(){"use strict";nodeLike=e=>{class t extends e{get firstChild(){return this.childNodes[0]}get lastChild(){return this.childNodes[this.childNodes.length-1]}}return t}}}),_AstNode_decorators,_init,AstNode,init_node=__esm({"lib/node.ts"(){"use strict";var e,t,s,n;init_nodeLike(),_AstNode_decorators=[nodeLike],AstNode=(n=class{constructor(){j(this,"childNodes",[]);v(this,e);v(this,t);v(this,s)}get parentNode(){return f(this,e)}get nextSibling(){return f(this,t)}get previousSibling(){return f(this,s)}getChildNodes(){const{childNodes:r}=this;return r}getAttribute(r){return r==="padding"?0:this[r]}setAttribute(r,i){switch(r){case"parentNode":y(this,e,i),i||(y(this,t,void 0),y(this,s,void 0));break;case"nextSibling":y(this,t,i);break;case"previousSibling":y(this,s,i);break;default:this[r]=i}}insertAdjacent(r,i){const{parentNode:o}=this;if(!o)throw new Error("There is no parent node!");const h=o.childNodes.indexOf(this)+i;for(let c=0;c<r.length;c++)o.insertAt(r[c],h+c)}after(...r){this.insertAdjacent(r,1)}before(...r){this.insertAdjacent(r,0)}remove(r){const{parentNode:i,nextSibling:o,previousSibling:h}=this,c=i==null?void 0:i.childNodes.indexOf(this);i==null||i.removeAt(c),r&&(o==null?void 0:o.type)==="text"&&(h==null?void 0:h.type)==="text"&&o.data.startsWith(`
`)&&h.data.endsWith(`
`)&&o.deleteData(0,1)}},e=new WeakMap,t=new WeakMap,s=new WeakMap,n),_init=__decoratorStart(null),AstNode=__decorateElement(_init,0,"AstNode",_AstNode_decorators,AstNode),__runInitializers(_init,1,AstNode)}}),basic,getCondition,init_selector=__esm({"util/selector.ts"(){"use strict";basic=e=>{if(e.includes("#")){const t=e.indexOf("#"),s=e.slice(0,t),n=e.slice(t+1);return(r,i)=>(t===0||r===s)&&i===n}return t=>t===e},getCondition=(e,t,s)=>{e=e.trim();const n=e.split(",").map(r=>r.trim()).filter(r=>r!=="").map(basic);return(({type:r,name:i})=>n.some(o=>o(r,i)))}}}),elementLike,init_elementLike=__esm({"mixin/elementLike.ts"(){"use strict";init_selector(),elementLike=e=>{var s,G;class t extends e{constructor(){super(...arguments);v(this,s)}getElementBy(o){const h=[...this.childNodes].reverse();for(;h.length>0;){const c=h.pop(),{type:p,childNodes:l}=c;if(p!=="text"){if(o(c))return c;for(let a=l.length-1;a>=0;a--)h.push(l[a])}}}querySelector(o){return this.getElementBy(E(this,s,G).call(this,o))}getElementsBy(o){const h=[...this.childNodes].reverse(),c=[];for(;h.length>0;){const p=h.pop(),{type:l,childNodes:a}=p;if(l!=="text"){o(p)&&c.push(p);for(let u=a.length-1;u>=0;u--)h.push(a[u])}}return c}querySelectorAll(o){return this.getElementsBy(E(this,s,G).call(this,o))}}return s=new WeakSet,G=function(o){return getCondition(o,this)},t}}}),_AstElement_decorators,_init2,_a,AstElement,init_element=__esm({"lib/element.ts"(){"use strict";init_string(),init_debug(),init_node(),init_elementLike(),_AstElement_decorators=[elementLike],AstElement=class extends(_a=AstNode){get length(){return this.childNodes.length}text(e){return text(this.childNodes,e)}removeAt(e){return setChildNodes(this,e,1)[0]}insertAt(e,t=this.length){return setChildNodes(this,t,0,[e]),e}append(...e){this.safeAppend(e)}safeAppend(e){for(const t of e)this.insertAt(t)}safeReplaceChildren(e){for(let t=this.length-1;t>=0;t--)this.removeAt(t);this.safeAppend([...e])}setText(e,t=0){t+=t<0?this.length:0;const s=this.childNodes[t],{data:n}=s;return s.replaceData(e),n}toString(e,t=""){return this.childNodes.map(s=>s.toString(e)).join(t)}replaceChildren(...e){this.safeReplaceChildren(e)}},_init2=__decoratorStart(_a),AstElement=__decorateElement(_init2,0,"AstElement",_AstElement_decorators,AstElement),__runInitializers(_init2,1,AstElement)}}),AstText,init_text=__esm({"lib/text.ts"(){"use strict";var e,V,s;init_node(),AstText=(s=class extends AstNode{constructor(r){super();v(this,e);j(this,"data","");this.data=r}get type(){return"text"}toString(r){return this.data}text(){return this.data}replaceData(r){E(this,e,V).call(this,r)}deleteData(r,i=1/0){E(this,e,V).call(this,this.data.slice(0,r)+(r<0&&r+i>=0?"":this.data.slice(r+i)))}},e=new WeakSet,V=function(r){this.setAttribute("data",r)},s)}}),OnlyincludeToken,init_onlyinclude=__esm({"src/onlyinclude.ts"(){"use strict";init_src(),OnlyincludeToken=class extends Token{get type(){return"onlyinclude"}toString(e){return`<onlyinclude>${super.toString(e)}</onlyinclude>`}isPlain(){return!0}}}}),hiddenToken,init_hidden=__esm({"mixin/hidden.ts"(){"use strict";hiddenToken=(e=!0,t=!0)=>s=>{class n extends s{text(){return""}}return n}}}),NowikiBaseToken,init_base=__esm({"src/nowiki/base.ts"(){"use strict";init_src(),NowikiBaseToken=class extends Token{get innerText(){return this.firstChild.data}constructor(e="",t,s){super(e,t,s)}}}}),_NoincludeToken_decorators,_init3,_a2,NoincludeToken,init_noinclude=__esm({"src/nowiki/noinclude.ts"(){"use strict";init_hidden(),init_base(),_NoincludeToken_decorators=[hiddenToken(!1)],NoincludeToken=class extends(_a2=NowikiBaseToken){get type(){return"noinclude"}toString(e){return e?"":super.toString()}},_init3=__decoratorStart(_a2),NoincludeToken=__decorateElement(_init3,0,"NoincludeToken",_NoincludeToken_decorators,NoincludeToken),__runInitializers(_init3,1,NoincludeToken)}}),TagPairToken,init_tagPair=__esm({"src/tagPair/index.ts"(){"use strict";var e,t,s;init_src(),TagPairToken=(s=class extends Token{constructor(r,i,o,h,c,p=[]){super(void 0,c);v(this,e);v(this,t);j(this,"closed");y(this,e,[r,h||r]),this.closed=h!=="",y(this,t,h===void 0),this.append(i,o);const l=typeof i=="string"?-1:p.indexOf(i);p.splice(l===-1?1/0:l,0,this)}get selfClosing(){return f(this,t)}set selfClosing(r){if(y(this,t,!!r),r){const{lastChild:i}=this;i.type==="text"?i.replaceData(""):i.replaceChildren()}}toString(r){const{firstChild:i,lastChild:o}=this,[h,c]=f(this,e);return f(this,t)?`<${h}${i.toString(r)}/>`:`<${h}${i.toString(r)}>${o.toString(r)}${this.closed?`</${c}>`:""}`}text(){const[r,i]=f(this,e);return f(this,t)?`<${r}${this.firstChild.text()}/>`:`<${r}${super.text(">")}${this.closed?`</${i}>`:""}`}},e=new WeakMap,t=new WeakMap,s)}}),_IncludeToken_decorators,_init4,_a3,IncludeToken,init_include=__esm({"src/tagPair/include.ts"(){"use strict";init_hidden(),init_tagPair(),_IncludeToken_decorators=[hiddenToken(!1)],IncludeToken=class extends(_a3=TagPairToken){get type(){return"include"}constructor(e,t="",s,n,r,i){super(e,t,s!=null?s:"",s===void 0||n!=null?n:"",r,i)}toString(e){return e?"":super.toString()}},_init4=__decoratorStart(_a3),IncludeToken=__decorateElement(_init4,0,"IncludeToken",_IncludeToken_decorators,IncludeToken),__runInitializers(_init4,1,IncludeToken)}}),AttributeToken,init_attribute=__esm({"src/attribute.ts"(){"use strict";var e,t,s,n;init_src(),AttributeToken=(n=class extends Token{constructor(i,o,h,c,p,l="",a,u=[]){const d=h;let g;if(o==="gallery"&&h==="caption"||o==="ref"&&h==="details"){const _=z(M({},p),{excludes:[...p.excludes,"heading","html","table","hr","list"]});g=new Token(a,_,u,{}),g.type="attr-value",g.setAttribute("stage",1)}else g=a!=null?a:"";super(void 0,p,u);v(this,e);v(this,t);v(this,s);y(this,e,i),this.append(d,g),y(this,t,l),y(this,s,[...c])}get type(){return f(this,e)}toString(i){const[o="",h=""]=f(this,s);return f(this,t)?super.toString(i,f(this,t)+o)+h:this.firstChild.toString(i)}text(){return f(this,t)?`${super.text(`${f(this,t).trim()}"`)}"`:this.firstChild.text()}},e=new WeakMap,t=new WeakMap,s=new WeakMap,n)}}),toAttributeType,AttributesToken,init_attributes=__esm({"src/attributes.ts"(){"use strict";var e,t;init_string(),init_src(),init_attribute(),toAttributeType=s=>s.slice(0,-1),AttributesToken=(t=class extends Token{constructor(n,r,i,o,h=[]){super(void 0,o,h,{});v(this,e);if(y(this,e,r),n){const c=/([^\s/][^\s/=]*)(?:(\s*=\s*)(?:(["'])([\s\S]*?)(\3|$)|(\S*)))?/gu;let p="",l=c.exec(n),a=0;const u=(()=>{p&&(super.insertAt(p),p="")});for(;l;){const{index:d,0:g,1:_,2:T,3:N,4:b,5:x,6:m}=l;if(p+=n.slice(a,d),/^[\w:][\w:.-]*$/u.test(removeComment(_).trim())){const A=b!=null?b:m,w=[N,x],C=new AttributeToken(toAttributeType(r),i,_,w,o,T,A,h);u(),super.insertAt(C)}else p+=g;({lastIndex:a}=c),l=c.exec(n)}p+=n.slice(a),u()}}get type(){return f(this,e)}},e=new WeakMap,t)}}),AtomToken,init_atom=__esm({"src/atom.ts"(){"use strict";var e,t;init_src(),AtomToken=(t=class extends Token{constructor(n,r,i,o,h){super(n,i,o,h);v(this,e);y(this,e,r)}get type(){return f(this,e)}},e=new WeakMap,t)}}),HeadingToken,init_heading=__esm({"src/heading.ts"(){"use strict";var e,t,U,n;init_src(),init_atom(),HeadingToken=(n=class extends Token{constructor(i,o,h,c=[]){super(void 0,h,c);v(this,t);v(this,e);y(this,e,i);const p=new Token(o[0],h,c);p.type="heading-title",p.setAttribute("stage",2);const l=new AtomToken(o[1],"heading-trail",h,c);this.append(p,l)}get type(){return"heading"}get level(){return f(this,e)}toString(i){const o=E(this,t,U).call(this);return o+this.firstChild.toString(i)+o+this.lastChild.toString(i)}text(){const i=E(this,t,U).call(this);return i+this.firstChild.text()+i}},e=new WeakMap,t=new WeakSet,U=function(){return"=".repeat(this.level)},n)}}),ParameterToken,init_parameter=__esm({"src/parameter.ts"(){"use strict";init_string(),init_src(),ParameterToken=class extends Token{get type(){return"parameter"}get anon(){return this.firstChild.length===0}constructor(e,t,s,n=[]){super(void 0,s,n);const r=new Token(typeof e=="number"?void 0:e,s,n,{}),i=new Token(t,s,n);r.type="parameter-key",r.setAttribute("stage",2),i.type="parameter-value",i.setAttribute("stage",2),this.append(r,i)}trimName(e,t=!0){const s=e.toString(!0).replace(/^[ \t\n\0\v]+|([^ \t\n\0\v])[ \t\n\0\v]+$/gu,"$1");return this.setAttribute("name",s),s}afterBuild(){if(!this.anon){const{parentNode:e,firstChild:t}=this,s=this.trimName(t);e&&e.getArgs(s,!1,!1).add(this)}super.afterBuild()}toString(e){return this.anon?this.lastChild.toString(e):super.toString(e,"=")}text(){return this.anon?this.lastChild.text():super.text("=")}getValue(){var t;const e=removeComment(this.lastChild.text());return this.anon&&((t=this.parentNode)==null?void 0:t.isTemplate())!==!1?e:e.trim()}setValue(e){this.lastChild.replaceChildren(e)}}}}),format,TranscludeToken,init_transclude=__esm({"src/transclude.ts"(){"use strict";var e,t,s,n,r,i,Y,Z,c;init_string(),init_debug(),init_src(),init_parameter(),init_atom(),format=p=>{const{lastChild:l,type:a}=p,u=l.type==="parameter";!(a==="template"?u&&l.anon:l.type==="magic-word-name")&&!l.toString().endsWith(`
`)&&(u?l.lastChild:l).insertAt(`
`)},TranscludeToken=(c=class extends Token{constructor(l,a,u,d=[]){var I,L;let g;const _=/^(?:\s|\0\d+[cn]\x7F)*\0(\d+)h\x7F(?:\s|\0\d+[cn]\x7F)*/u.exec(l);_&&(g=Number(_[1]),l=l.replace(`\0${g}h`,d[g].toString().replace(/^\n/u,"")));super(void 0,u,d,{});v(this,i);j(this,"modifier","");v(this,e,"template");v(this,t,":");v(this,s,!1);v(this,n,new Map);v(this,r);const{parserFunction:T,variable:N,functionHook:b}=u,x=(I=/^(?:\s|\0\d+[cn]\x7F)*\0\d+s\x7F/u.exec(l))==null?void 0:I[0];if(x)this.setAttribute("modifier",x),l=l.slice(x.length);else if(l.includes(":")){const[O,...S]=l.split(":"),[$]=/^(?:\s|\0\d+[cn]\x7F)*/u.exec((L=S[0])!=null?L:"");this.setModifier(`${O}:${$}`)&&(l=S.join(":").slice($.length))}const m=l.search(/[:：]/u),A=l[m]==="：",w=m!==-1;if(w||a.length===0&&!f(this,s)){const O=w?l.slice(0,m):l,S=w&&l.slice(m+1),$=removeComment(O),P=w?$.slice($.search(/\S/u))+(A?"：":""):$.trim(),[,F,q]=getMagicWordInfo(P,T),W=!("functionHook"in u)||b.includes(q),B=N.includes(q);if(w?q&&W:B){this.setAttribute("name",q),y(this,e,"magic-word"),A&&y(this,t,"：");const R=new AtomToken(O,"magic-word-name",u,d);super.insertAt(R),S!==!1&&a.unshift([S])}}if(this.type==="template"){const O=removeComment(l).trim();if(!this.normalizeTitle(O,10,{halfParsed:!0,temporary:!0}).valid)throw d.pop(),new SyntaxError("Invalid template name");const S=new AtomToken(l,"template-name",u,d,{});super.insertAt(S)}typeof g=="number"&&(d[g]=void 0);const C=this.isTemplate();let k=1;for(let O=0;O<a.length;O++){const S=a[O];C||(S[0]=S.join("="),S.length=1),S.length===1&&(S.unshift(k),k++),this.insertAt(new ParameterToken(...S,u,d))}}get type(){return f(this,e)}setModifier(l){const{parserFunction:[,,a,u]}=this.getAttribute("config"),g=removeComment(l).trim().slice(0,-1).toLowerCase(),_=a.includes(g),T=u.includes(g);return _||T||!l?(this.setAttribute("modifier",l),y(this,s,_),!!l):!1}isTemplate(){return this.type==="template"}afterBuild(){this.modifier.includes("\0")&&this.setAttribute("modifier",this.buildFromStr(this.modifier,0)),super.afterBuild(),this.isTemplate()&&(y(this,r,E(this,i,Y).call(this)),this.setAttribute("name",f(this,r).title))}toString(l){const{childNodes:a,length:u,firstChild:d,modifier:g,type:_,name:T}=this;return`{{${g}${_==="magic-word"?d.toString(l)+(u===1?"":f(this,t))+a.slice(1).map(N=>N.toString(l)).join("|"):super.toString(l,"|")}}}`}text(){const{childNodes:l,length:a,firstChild:u,modifier:d,type:g}=this;return`{{${d}${g==="magic-word"?u.text()+(a===1?"":f(this,t))+text(l.slice(1),"|"):super.text("|")}}}`}insertAt(l,a=this.length){return super.insertAt(l,a),l.anon?E(this,i,Z).call(this,l):l.name&&this.getArgs(l.name,!1,!1).add(l),l}getAllArgs(){return this.childNodes.slice(1)}getAnonArgs(){return this.getAllArgs().filter(({anon:l})=>l)}getArgs(l,a,u=!0){const d=String(l).replace(/^[ \t\n\0\v]+|([^ \t\n\0\v])[ \t\n\0\v]+$/gu,"$1");let g;return f(this,n).has(d)?g=f(this,n).get(d):(g=new Set(this.getAllArgs().filter(({name:_})=>d===_)),f(this,n).set(d,g)),g}getArg(l){const{childNodes:a}=this;return[...this.getArgs(l)].sort((u,d)=>a.indexOf(d)-a.indexOf(u))[0]}getValue(l){var a;return(a=this.getArg(l))==null?void 0:a.getValue()}setValue(l,a,u){const d=this.getArg(l);if(d){d.setValue(a);return}u&&format(this),this.insertAt(new ParameterToken(String(l),a,this.getAttribute("config")))}},e=new WeakMap,t=new WeakMap,s=new WeakMap,n=new WeakMap,r=new WeakMap,i=new WeakSet,Y=function(){const l=this.type==="template";return this.normalizeTitle(this.childNodes[0].text(),10,M({temporary:!0},!l&&{page:""}))},Z=function(l){const a=this.getAnonArgs(),u=!0,d=l,g=String(a.length);d.setAttribute("name",g),this.getArgs(g,!1,!1).add(d)},c)}}),_HiddenToken_decorators,_init5,_a4,HiddenToken,init_hidden2=__esm({"src/hidden.ts"(){"use strict";init_hidden(),init_src(),_HiddenToken_decorators=[hiddenToken()],HiddenToken=class extends(_a4=Token){get type(){return"hidden"}},_init5=__decoratorStart(_a4),HiddenToken=__decorateElement(_init5,0,"HiddenToken",_HiddenToken_decorators,HiddenToken),__runInitializers(_init5,1,HiddenToken)}}),ArgToken,init_arg=__esm({"src/arg.ts"(){"use strict";init_string(),init_src(),init_atom(),init_hidden2(),ArgToken=class extends Token{get type(){return"arg"}constructor(e,t,s=[]){super(void 0,t,s,{});for(let n=0;n<e.length;n++){const r=e[n];if(n===0){const i=new AtomToken(r,"arg-name",t,s,{});super.insertAt(i)}else if(n>1){const i=new HiddenToken(r,t,s);super.insertAt(i)}else{const i=new Token(r,t,s);i.type="arg-default",i.setAttribute("stage",2),super.insertAt(i)}}}toString(e){return`{{{${super.toString(e,"|")}}}}`}text(){return`{{{${text(this.childNodes.slice(0,2),"|")}}}}`}}}}),braces_exports={};__export(braces_exports,{parseBraces:()=>parseBraces});var closes,lbrack,newline,openBraces,marks,getExecRegex,reReplace,getSymbol,parseBraces,init_braces=__esm({"parser/braces.ts"(){"use strict";init_dist(),init_string(),init_heading(),init_transclude(),init_arg(),closes={"=":String.raw`\n(?!(?:[^\S\n]|\0\d+[cn]\x7F)*\n)`,"{":String.raw`\}{2,}|\|`,"-":String.raw`\}-`,"[":String.raw`\]\]`},lbrack=String.raw`\[(?!\[)`,newline=String.raw`\n(?![=\0])`,openBraces=String.raw`|\{{2,}`,marks=new Map([["!","!"],["!!","+"],["(!","{"],["!)","}"],["!-","-"],["=","~"],["server","m"]]),getExecRegex=getRegex(e=>new RegExp(e,"gmu")),reReplace=new RegExp(String.raw`\{\{((?:[^\n{}[]|${lbrack}|${newline})*)\}\}(?!\})`+"|"+String.raw`\[\[(?:[^\n[\]{]|${newline})*\]\]`+"|"+String.raw`-\{(?:[^\n{}[]|${lbrack}|${newline})*\}-`,"gu"),getSymbol=e=>{const t=trimLc(removeComment(e));return marks.has(t)?marks.get(t):/^(?:filepath|(?:full|canonical)urle?):./u.test(t)?"m":"t"},parseBraces=(e,t,s)=>{var g,_,T,N,b;const n=String.raw`${t.excludes.includes("heading")?"":String.raw`^((?:\0\d+[cno]\x7F)*)={1,6}|`}\[\[|-\{(?!\{)`,{parserFunction:[,,,r]}=t,i=[],o=[],h=(x,m,A,w)=>{m[m.length-1].push(restore(x.slice(A,w),o))};let c;do c!==void 0&&(e=c),c=e.replace(reReplace,(x,m,A)=>{if(m!==void 0||typeof A=="string")try{const{length:w}=s,C=(m!=null?m:A).split("|");return new TranscludeToken(restore(C[0],o),C.slice(1).map(k=>{const I=k.indexOf("=");return(I===-1?[k]:[k.slice(0,I),k.slice(I+1)]).map(L=>restore(L,o))}),t,s),`\0${w}${getSymbol(C[0])}`}catch(w){if(!(w instanceof SyntaxError)||w.message!=="Invalid template name")throw w}return o.push(restore(x,o)),`\0${o.length-1}`});while(c!==e);e=c;const p=e.lastIndexOf("}}")-e.length;let l=p+e.length!==-1,a=getExecRegex(n+(l?openBraces:"")),u=a.exec(e),d;for(;u||d!==void 0&&d<=e.length&&((_=(g=i[i.length-1])==null?void 0:g[0])!=null&&_.startsWith("="));){if(u!=null&&u[1]){const[,{length:$}]=u;u[0]=u[0].slice($),u.index+=$}const{0:x,index:m}=u!=null?u:{0:`
`,index:e.length},A=(T=i.pop())!=null?T:{},{0:w,index:C,parts:k,findEqual:I,pos:L}=A,O=x==="="&&I;if(x==="]]"||x==="}-")d=m+2;else if(x===`
`){d=m+1;const{pos:$,findEqual:P}=(N=i[i.length-1])!=null?N:{};if($===void 0||P||removeComment(e.slice($,C))!==""){const F=/^(={1,6})(.+)\1((?:\s|\0\d+[cn]\x7F)*)$/u.exec(e.slice(C,m));F&&(F[2]=restore(F[2],o),F[2].includes(`
`)||(e=`${e.slice(0,C)}\0${s.length}h${e.slice(m)}`,d=C+4+String(s.length).length,new HeadingToken(F[1].length,F.slice(2),t,s)))}}else if(x==="|"||O)d=m+1,h(e,k,L,m),x==="|"&&k.push([]),A.pos=d,A.findEqual=x==="|",i.push(A);else if(x.startsWith("}}")){const $=x.slice(0,Math.min(w.length,3)),P=w.length-$.length,{length:F}=s;d=m+$.length,h(e,k,L,m);let q=!1,W="t";if($.length===3){const B=k.map(re=>re.join("=")),R=B.length>1&&removeComment(B[1]).trim();new ArgToken(B,t,s),R&&R.endsWith(":")&&r.includes(R.slice(0,-1).toLowerCase())&&(W="s")}else try{new TranscludeToken(k[0][0],k.slice(1),t,s),W=getSymbol(k[0][0])}catch(B){if(B instanceof SyntaxError&&B.message==="Invalid template name")q=!0;else throw B}q||(e=`${e.slice(0,C+P)}\0${F}${W}${e.slice(d)}`,d=C+P+3+String(F).length,P>1?i.push({0:w.slice(0,P),index:C,pos:C+P,parts:[[]]}):P===1&&e[C-1]==="-"&&i.push({0:"-{",index:C-1,pos:C+1,parts:[[]]}))}else d=m+x.length,x.startsWith("{")&&(u.pos=d,u.parts=[[]]),i.push(..."0"in A?[A]:[],u);let S=i[i.length-1];if(l&&p+e.length<d)for(l=!1;(b=S==null?void 0:S[0])!=null&&b.startsWith("{");)i.pop(),S=i[i.length-1];a=getExecRegex(n+(l?openBraces:"")+(S?`|${closes[S[0][0]]}${S.findEqual?"|=":""}`:"")),a.lastIndex=d,u=a.exec(e)}return restore(e,o)}}}),nested_exports={};__export(nested_exports,{NestedToken:()=>NestedToken});var NestedToken,init_nested=__esm({"src/nested.ts"(){"use strict";init_commentAndExt(),init_braces(),init_src(),NestedToken=class extends Token{get type(){return"ext-inner"}constructor(e,t,s,n,r=[]){const i=Symbol("NestedToken"),{length:o}=r;r.push(i),e&&(e=parseCommentAndExt(e,n,r,t)),e&&(e=parseBraces(e,n,r)),r.splice(o,1),super(e,n,r)}}}}),MultiLineToken,init_multiLine=__esm({"src/multiLine/index.ts"(){"use strict";init_src(),MultiLineToken=class extends Token{get type(){return"ext-inner"}toString(e){return super.toString(e,`
`)}text(){return super.text(`
`).replace(/\n\s*\n/gu,`
`)}}}}),LinkBaseToken,init_base2=__esm({"src/link/base.ts"(){"use strict";var e,t;init_src(),LinkBaseToken=(t=class extends Token{constructor(n,r,i,o=[],h="|"){super(void 0,i,o,{});v(this,e);this.insertAt(n),y(this,e,h)}toString(n){return super.toString(n,f(this,e))}text(){return super.text("|")}},e=new WeakMap,t)}}),ImageParameterToken,init_imageParameter=__esm({"src/imageParameter.ts"(){"use strict";init_src(),ImageParameterToken=class extends Token{get type(){return"image-parameter"}}}}),FileToken,init_file=__esm({"src/link/file.ts"(){"use strict";init_base2(),init_imageParameter(),FileToken=class extends LinkBaseToken{constructor(e,t,s,n=[],r="|",i){super(e,void 0,s,n,r),t!==void 0&&this.append(new ImageParameterToken(t,s,n))}}}}),GalleryImageToken,init_galleryImage=__esm({"src/link/galleryImage.ts"(){"use strict";init_constants(),init_src(),init_file(),GalleryImageToken=class extends FileToken{constructor(t,s,n,r,i=[]){let o;if(n!==void 0){const{length:c}=i;o=new Token(n,r,i);for(let p=0;p<MAX_STAGE;p++)o.parseOnce();i.splice(c,1)}const h=`${t}-image`;super(s,o==null?void 0:o.firstChild.toString(),r,i,void 0,h);j(this,"privateType","imagemap-image");this.privateType=h}get type(){return this.privateType}}}}),gallery_exports={};__export(gallery_exports,{GalleryToken:()=>GalleryToken});var GalleryToken,init_gallery=__esm({"src/multiLine/gallery.ts"(){"use strict";var e,ee,s;init_multiLine(),init_galleryImage(),GalleryToken=(s=class extends MultiLineToken{constructor(r,i,o=[]){var h;super(void 0,i,o,{});v(this,e);for(const c of(h=r==null?void 0:r.split(`
`))!=null?h:[]){const p=/^([^|]+)(?:\|(.*))?/u.exec(c);if(!p){super.insertAt(c);continue}const[,l,a]=p;E(this,e,ee).call(this,l)?super.insertAt(new GalleryImageToken("gallery",l,a,i,o)):super.insertAt(c)}}},e=new WeakSet,ee=function(r){return this.normalizeTitle(r,6,{halfParsed:!0,temporary:!0,decode:!0,page:""}).valid},s)}}),nowiki_exports={};__export(nowiki_exports,{NowikiToken:()=>NowikiToken});var NowikiToken,init_nowiki=__esm({"src/nowiki/index.ts"(){"use strict";init_base(),NowikiToken=class extends NowikiBaseToken{get type(){return"ext-inner"}safeReplaceChildren(e){e.length===0?this.setText(""):super.safeReplaceChildren(e)}}}}),ExtToken,init_ext=__esm({"src/tagPair/ext.ts"(){"use strict";init_index(),init_src(),init_tagPair(),init_attributes(),ExtToken=class extends TagPairToken{get type(){return"ext"}constructor(e,t,s,n,r=index_default.getConfig(),i=!1,o=[]){const h=e.toLowerCase(),c=new AttributesToken(!t||/^\s/u.test(t)?t:` ${t}`,"ext-attrs",h,r,o),p=z(M({},r),{ext:r.ext.filter(a=>a!==h),excludes:[...r.excludes]});let l;switch(h){case"indicator":case"poem":case"ref":h==="poem"&&p.excludes.push("heading"),l=new Token(s,p,o);break;case"references":{const{NestedToken:a}=(init_nested(),__toCommonJS(nested_exports));p.excludes.push("heading"),l=new a(s,i,["ref"],p,o);break}case"gallery":{const{GalleryToken:a}=(init_gallery(),__toCommonJS(gallery_exports));l=new a(s,p,o);break}default:{const{NowikiToken:a}=(init_nowiki(),__toCommonJS(nowiki_exports));l=new a(s,p,o)}}l.setAttribute("name",h),l.type==="plain"&&(l.type="ext-inner"),super(e,c,l,n,r,o)}}}}),_CommentToken_decorators,_init6,_a5,CommentToken,init_comment=__esm({"src/nowiki/comment.ts"(){"use strict";init_hidden(),init_base(),_CommentToken_decorators=[hiddenToken(!1)],CommentToken=class extends(_a5=NowikiBaseToken){constructor(t,s,n,r){super(t,n,r);j(this,"closed");this.closed=s}get type(){return"comment"}toString(t){return t?"":`<!--${this.innerText}${this.closed?"-->":""}`}},_init6=__decoratorStart(_a5),CommentToken=__decorateElement(_init6,0,"CommentToken",_CommentToken_decorators,CommentToken),__runInitializers(_init6,1,CommentToken)}}),commentAndExt_exports={};__export(commentAndExt_exports,{parseCommentAndExt:()=>parseCommentAndExt});var onlyincludeLeft,onlyincludeRight,length,getExtRegex,update,parseCommentAndExt,init_commentAndExt=__esm({"parser/commentAndExt.ts"(){"use strict";init_dist(),init_onlyinclude(),init_noinclude(),init_include(),init_ext(),init_comment(),onlyincludeLeft="<onlyinclude>",onlyincludeRight="</onlyinclude>",{length}=onlyincludeLeft,getExtRegex=[!1,!0].map(e=>{const t=e?"includeonly":"(?:no|only)include",s=e?"noinclude":"includeonly";return getRegex(n=>new RegExp(String.raw`<!--[\s\S]*?(?:-->|$)|<${t}(?:\s[^>]*)?/?>|</${t}\s*>|<(${n})(\s[^>]*?)?(?:/>|>([\s\S]*?)</(${"\\1"}\s*)>)|<(${s})(\s[^>]*?)?(?:/>|>([\s\S]*?)(?:</(${s}\s*)>|$))`,"giu"))}),update=e=>{const t=e.indexOf(onlyincludeLeft);return{i:t,j:e.indexOf(onlyincludeRight,t+length)}},parseCommentAndExt=(e,t,s,n)=>{if(n){let{i:c,j:p}=update(e);if(c!==-1&&p!==-1){let l="";const a=u=>{new NoincludeToken(u,t,s),l+=`\0${s.length-1}n`};for(;c!==-1&&p!==-1;){const u=`\0${s.length}g`;new OnlyincludeToken(e.slice(c+length,p),t,s),c>0&&a(e.slice(0,c)),l+=u,e=e.slice(p+length+1),{i:c,j:p}=update(e)}return e&&a(e),l}}const{ext:r}=t;let i=r,o=t;r.includes("translate")&&(i=r.filter(c=>c!=="translate"&&c!=="tvar"),o=z(M({},t),{ext:i}));const h=getExtRegex[n?1:0](i.join("|"));return h.lastIndex=0,h.test(e)?e.replace(h,(c,p,l,a,u,d,g,_,T)=>{const N=s.length;let b="n";if(p)b="e",new ExtToken(p,l,a,u,o,d,s);else if(c.startsWith("<!--")){b="c";const x=c.endsWith("-->");new CommentToken(c.slice(4,x?-3:void 0),x,t,s)}else d?new IncludeToken(d,g,_,T,t,s):new NoincludeToken(c,t,s,!0);return`\0${N}${b}`}):e}}}),src_exports={};__export(src_exports,{Token:()=>Token});var Token,init_src=__esm({"src/index.ts"(){"use strict";var e,t,s,n,r,i,te,se,c;init_string(),init_constants(),init_debug(),init_index(),init_element(),init_text(),Token=(c=class extends AstElement{constructor(a,u=index_default.getConfig(),d=[],g){super();v(this,i);v(this,e,"plain");v(this,t,0);v(this,s);v(this,n);v(this,r);typeof a=="string"&&this.insertAt(a),y(this,s,u),y(this,n,d),d.push(this)}get type(){return f(this,e)}set type(a){y(this,e,a)}parseOnce(a=f(this,t),u=!1,d){if(a<f(this,t)||this.length!==1||!this.isPlain())return this;if(f(this,t)>=MAX_STAGE)return this;switch(a){case 0:this.type==="root"&&f(this,n).pop(),y(this,r,u),E(this,i,te).call(this,u);break;case 1:E(this,i,se).call(this)}if(this.type==="root")for(const g of f(this,n))g==null||g.parseOnce(a,u,d);return Q(this,t)._++,this}buildFromStr(a,u){const d=a.split(/[\0\x7F]/u).map((g,_)=>{if(_%2===0)return g&&new AstText(g);const T=Number(g.slice(0,-1));if(isNaN(g.slice(-1))&&Number.isInteger(T)&&T>=0&&T<f(this,n).length)return f(this,n)[T];throw new Error(`Failed to build! Unrecognized token: ${g}`)}).filter(g=>g!=="");return u===0?d.map(String).join(""):u===1?text(d):d}build(){y(this,t,MAX_STAGE);const{length:a,firstChild:u}=this,d=u==null?void 0:u.toString();if(a===1&&u.type==="text"&&d.includes("\0")&&(setChildNodes(this,0,1,this.buildFromStr(d)),this.type==="root"))for(const g of f(this,n))g==null||g.build()}afterBuild(){if(this.type==="root")for(const a of f(this,n))a==null||a.afterBuild()}parse(a=MAX_STAGE,u,d){for(a=Math.min(a,MAX_STAGE);f(this,t)<a;)this.parseOnce(f(this,t),u,d);return a&&(this.build(),this.afterBuild()),this}isPlain(){return this.constructor===c}getAttribute(a){switch(a){case"config":return f(this,s);default:return super.getAttribute(a)}}setAttribute(a,u){switch(a){case"stage":f(this,t)===0&&this.type==="root"&&f(this,n).shift(),y(this,t,u);break;default:super.setAttribute(a,u)}}insertAt(a,u=this.length){const d=typeof a=="string"?new AstText(a):a,{length:g}=this;u+=u<0?g:0,super.insertAt(d,u);const{type:_}=d;return _==="root"&&(d.type="plain"),d}normalizeTitle(a,u=0,d){return index_default.normalizeTitle(a,u,f(this,r),f(this,s),d)}},e=new WeakMap,t=new WeakMap,s=new WeakMap,n=new WeakMap,r=new WeakMap,i=new WeakSet,te=function(a){const{parseCommentAndExt:u}=(init_commentAndExt(),__toCommonJS(commentAndExt_exports));this.setText(u(this.firstChild.toString(),f(this,s),f(this,n),a))},se=function(){const{parseBraces:a}=(init_braces(),__toCommonJS(braces_exports)),u=this.type==="root"?this.firstChild.toString():`\0${this.firstChild.toString()}`,d=a(u,f(this,s),f(this,n));this.setText(this.type==="root"?d:d.slice(1))},c)}}),index_exports={};__export(index_exports,{default:()=>index_default}),module.exports=__toCommonJS(index_exports);var Parser,index_default,init_index=__esm({"index.ts"(){init_debug(),init_constants(),init_string(),init_title(),Parser={getConfig(e){const t=e!=null?e:this.config,{}=t;return z(M(M({},minConfig),t),{excludes:[]})},normalizeTitle(e,t=0,s,n=Parser.getConfig(),r){let i;if(r!=null&&r.halfParsed)i=new Title(e,t,n,r);else{const{Token:o}=(init_src(),__toCommonJS(src_exports));i=Shadow.run(()=>{const h=new o(e,n);h.type="root",h.parseOnce(0,s).parseOnce();const c=new Title(h.firstChild.toString(),t,n,r);h.build();for(const p of["main"]){const l=c[p];if(l!=null&&l.includes("\0")){const a=h.buildFromStr(l,1);c.main=a}}return c},this)}return i},parse(e,t,s,n,r){e=tidy(e);let i,o,h,c;typeof t=="string"?(i=!!s,o=n,h=r):(i=!!t,o=s,h=n),o!=null||(o=MAX_STAGE),h!=null||(h=this.getConfig());const{Token:p}=(init_src(),__toCommonJS(src_exports));return Shadow.run(()=>{const a=new p(e,h);return a.type="root",a.parse(o,i)})}},index_default=Parser}});init_index();
//# sourceMappingURL=bundle.min.js.map
