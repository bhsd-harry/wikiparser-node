"use strict";var ne=Object.defineProperty,oe=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var X=e=>{throw TypeError(e)};var H=(e,t,r)=>t in e?ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,q=(e,t)=>{for(var r in t||(t={}))le.call(t,r)&&H(e,r,t[r]);if(J)for(var r of J(t))ce.call(t,r)&&H(e,r,t[r]);return e},W=(e,t)=>oe(e,ae(t));var I=(e,t,r)=>H(e,typeof t!="symbol"?t+"":t,r),V=(e,t,r)=>t.has(e)||X("Cannot "+r);var f=(e,t,r)=>(V(e,t,"read from private field"),r?r.call(e):t.get(e)),v=(e,t,r)=>t.has(e)?X("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),x=(e,t,r,i)=>(V(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r),F=(e,t,r)=>(V(e,t,"access private method"),r);var Q=(e,t,r,i)=>({set _(s){x(e,t,s,r)},get _(){return f(e,t,i)}});var __create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__knownSymbol=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),__typeError=e=>{throw TypeError(e)},__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__name=(e,t)=>__defProp(e,"name",{value:t,configurable:!0}),__esm=(e,t)=>function(){return e&&(t=(0,e[__getOwnPropNames(e)[0]])(e=0)),t},__commonJS=(e,t)=>function(){return t||(0,e[__getOwnPropNames(e)[0]])((t={exports:{}}).exports,t),t.exports},__export=(e,t)=>{for(var r in t)__defProp(e,r,{get:t[r],enumerable:!0})},__copyProps=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of __getOwnPropNames(t))!__hasOwnProp.call(e,s)&&s!==r&&__defProp(e,s,{get:()=>t[s],enumerable:!(i=__getOwnPropDesc(t,s))||i.enumerable});return e},__toCommonJS=e=>__copyProps(__defProp({},"__esModule",{value:!0}),e),__decoratorStart=e=>{var t;return[,,,__create((t=e==null?void 0:e[__knownSymbol("metadata")])!=null?t:null)]},__decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=e=>e!==void 0&&typeof e!="function"?__typeError("Function expected"):e,__decoratorContext=(e,t,r,i,s)=>({kind:__decoratorStrings[e],name:t,metadata:i,addInitializer:n=>r._?__typeError("Already initialized"):s.push(__expectFn(n||null))}),__decoratorMetadata=(e,t)=>__defNormalProp(t,__knownSymbol("metadata"),e[3]),__runInitializers=(e,t,r,i)=>{for(var s=0,n=e[t>>1],a=n&&n.length;s<a;s++)t&1?n[s].call(r):i=n[s].call(r,i);return i},__decorateElement=(e,t,r,i,s,n)=>{var a,u,h,p,l,o=t&7,c=!!(t&8),d=!!(t&16),g=o>3?e.length+1:o?c?1:2:0,_=__decoratorStrings[o+5],k=o>3&&(e[g-1]=[]),E=e[g]||(e[g]=[]),b=o&&(!d&&!c&&(s=s.prototype),o<5&&(o>3||!d)&&__getOwnPropDesc(o<4?s:{get[r](){return __privateGet(this,n)},set[r](m){return __privateSet(this,n,m)}},r));o?d&&o<4&&__name(n,(o>2?"set ":o>1?"get ":"")+r):__name(s,r);for(var A=i.length-1;A>=0;A--)p=__decoratorContext(o,r,h={},e[3],E),o&&(p.static=c,p.private=d,l=p.access={has:d?m=>__privateIn(s,m):m=>r in m},o^3&&(l.get=d?m=>(o^1?__privateGet:__privateMethod)(m,s,o^4?n:b.get):m=>m[r]),o>2&&(l.set=d?(m,T)=>__privateSet(m,s,T,o^4?n:b.set):(m,T)=>m[r]=T)),u=(0,i[A])(o?o<4?d?n:b[_]:o>4?void 0:{get:b.get,set:b.set}:s,p),h._=1,o^4||u===void 0?__expectFn(u)&&(o>4?k.unshift(u):o?d?n=u:b[_]=u:s=u):typeof u!="object"||u===null?__typeError("Object expected"):(__expectFn(a=u.get)&&(b.get=a),__expectFn(a=u.set)&&(b.set=a),__expectFn(a=u.init)&&k.unshift(a));return o||__decoratorMetadata(e,s),b&&__defProp(s,r,b),d?o^4?n:b:s},__accessCheck=(e,t,r)=>t.has(e)||__typeError("Cannot "+r),__privateIn=(e,t)=>Object(t)!==t?__typeError('Cannot use the "in" operator on this value'):e.has(t),__privateGet=(e,t,r)=>(__accessCheck(e,t,"read from private field"),r?r.call(e):t.get(e)),__privateSet=(e,t,r,i)=>(__accessCheck(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r),__privateMethod=(e,t,r)=>(__accessCheck(e,t,"access private method"),r),require_minimum=__commonJS({"config/minimum.json"(e,t){t.exports={ext:[],namespaces:{0:"",6:"File",10:"Template"},nsid:{"":0,file:6,template:10},functionHook:[],variable:["!","="],parserFunction:[{},{"!":"!","=":"="},["msg","raw"],["subst","safesubst"]]}}}),MAX_STAGE,minConfig,init_constants=__esm({"util/constants.ts"(){"use strict";MAX_STAGE=2,minConfig=require_minimum()}});function getRegex(e){const t=new Map,r=new WeakMap;return i=>{const s=typeof i=="string"?t:r;if(s.has(i)){const a=s.get(i);return a.lastIndex=0,a}const n=e(i);return s.set(i,n),n}}var rawurldecode,getObjRegex,init_dist=__esm({"../common/dist/index.mjs"(){"use strict";rawurldecode=e=>decodeURIComponent(e.replace(/%(?![\da-f]{2})/giu,"%25")),getObjRegex=getRegex}});function restore(e,t){return e.replace(/\0(\d+)\x7F/gu,(r,i)=>t[i])}var trimLc,factory,tidy,removeComment,text,names,decodeHtmlBasic,decodeHtml,init_string=__esm({"util/string.ts"(){"use strict";init_dist(),trimLc=e=>e.trim().toLowerCase(),factory=(e,t)=>r=>r.replace(e,t),tidy=factory(/[\0\x7F]|\r$/gmu,""),removeComment=factory(/\0\d+[cn]\x7F/gu,""),text=(e,t="")=>e.map(r=>typeof r=="string"?r:r.text()).join(t),names={lt:"<",gt:">",lbrack:"[",rbrack:"]",lbrace:"{",rbrace:"}",nbsp:" ",amp:"&",quot:'"'},decodeHtmlBasic=factory(/&(?:#(\d+|[Xx][\da-fA-F]+)|([lg]t|[LG]T|[lr]brac[ke]|nbsp|amp|AMP|quot|QUOT));/gu,(e,t,r)=>t?String.fromCodePoint(+((/^x/iu.test(t)?"0":"")+t)):names[r.toLowerCase()]),decodeHtml=e=>decodeHtmlBasic(e)}}),title_exports={};__export(title_exports,{Title:()=>Title});var Title,init_title=__esm({"lib/title.ts"(){"use strict";var e,t,r,i;init_string(),Title=(i=class{constructor(s,n,a,{temporary:u,decode:h,selfLink:p}={}){v(this,e);v(this,t);v(this,r);I(this,"valid");const l=s.trim().startsWith("../");if(h&&s.includes("%"))try{s=rawurldecode(s)}catch(c){}if(s=decodeHtml(s).replace(/[_ ]+/gu," ").trim(),l)x(this,r,0);else{let c=n;s.startsWith(":")&&(c=0,s=s.slice(1).trim());const d=s.split(":");if(d.length>1){const g=trimLc(d[0]),_=Object.prototype.hasOwnProperty.call(a.nsid,g)&&a.nsid[g];_&&(c=_,s=d.slice(1).join(":").trim())}x(this,r,c)}const o=s.indexOf("#");o!==-1&&(s=s.slice(0,o).trim()),this.valid=!!s&&decodeHtml(s)===s&&!/^:|\0\d+[eh!+-]\x7F|[<>[\]{}|\n]|%[\da-f]{2}|(?:^|\/)\.{1,2}(?:$|\/)/iu.test(l?/^(?:\.\.\/)+(.*)/u.exec(s)[1]:s),this.main=s,x(this,t,a.namespaces)}get ns(){return f(this,r)}get main(){return f(this,e)}set main(s){s=s.replace(/_/gu," ").trim(),x(this,e,s&&s[0].toUpperCase()+s.slice(1))}get prefix(){const s=f(this,t)[this.ns];return s+(s&&":")}get title(){return this.getRedirection()[1]}getRedirection(){return[!1,(this.prefix+this.main).replace(/ /gu,"_")]}},e=new WeakMap,t=new WeakMap,r=new WeakMap,i)}}),setChildNodes,init_debug=__esm({"util/debug.ts"(){"use strict";setChildNodes=(e,t,r,i=[])=>{var a,u;let s=e.getChildNodes(),n;s.length===r?(n=s,s=i):n=s.splice(t,r,...i);for(let h=0;h<i.length;h++){const p=i[h];p.setAttribute("parentNode",e),p.setAttribute("nextSibling",s[t+h+1]),p.setAttribute("previousSibling",s[t+h-1])}return(a=s[t-1])==null||a.setAttribute("nextSibling",s[t]),(u=s[t+i.length])==null||u.setAttribute("previousSibling",s[t+i.length-1]),s===i&&e.setAttribute("childNodes",s),n}}}),nodeLike,init_nodeLike=__esm({"mixin/nodeLike.ts"(){"use strict";nodeLike=e=>{class t extends e{get firstChild(){return this.childNodes[0]}get lastChild(){return this.childNodes[this.childNodes.length-1]}}return t}}}),_AstNode_decorators,_init,AstNode,init_node=__esm({"lib/node.ts"(){"use strict";var e,t,r,i;init_nodeLike(),_AstNode_decorators=[nodeLike],AstNode=(i=class{constructor(){I(this,"childNodes",[]);v(this,e);v(this,t);v(this,r)}get parentNode(){return f(this,e)}get nextSibling(){return f(this,t)}get previousSibling(){return f(this,r)}getChildNodes(){const{childNodes:s}=this;return s}getAttribute(s){return this[s]}setAttribute(s,n){switch(s){case"parentNode":x(this,e,n),n||(x(this,t,void 0),x(this,r,void 0));break;case"nextSibling":x(this,t,n);break;case"previousSibling":x(this,r,n);break;default:this[s]=n}}insertAdjacent(s,n){const{parentNode:a}=this;if(!a)throw new Error("There is no parent node!");const u=a.childNodes.indexOf(this)+n;for(let h=0;h<s.length;h++)a.insertAt(s[h],u+h)}after(...s){this.insertAdjacent(s,1)}before(...s){this.insertAdjacent(s,0)}remove(){var s;(s=this.parentNode)==null||s.removeChild(this)}},e=new WeakMap,t=new WeakMap,r=new WeakMap,i),_init=__decoratorStart(null),AstNode=__decorateElement(_init,0,"AstNode",_AstNode_decorators,AstNode),__runInitializers(_init,1,AstNode)}}),basic,getCondition,init_selector=__esm({"parser/selector.ts"(){"use strict";basic=(e,t,r)=>{if(e.includes("#")){const i=e.indexOf("#");return(i===0||e.slice(0,i)===t)&&e.slice(i+1)===r}return!e||e===t},getCondition=(e,t,r)=>{const i=e.split(",");return({type:s,name:n})=>i.some(a=>basic(a.trim(),s,n))}}}),elementLike,init_elementLike=__esm({"mixin/elementLike.ts"(){"use strict";init_selector(),elementLike=e=>{var r,D;class t extends e{constructor(){super(...arguments);v(this,r)}getElementBy(a){for(const u of this.childNodes){if(u.type==="text")continue;if(a(u))return u;const h=u.getElementBy(a);if(h)return h}}querySelector(a){return this.getElementBy(F(this,r,D).call(this,a))}getElementsBy(a,u=[]){for(const h of this.childNodes)h.type!=="text"&&(a(h)&&u.push(h),h.getElementsBy(a,u));return u}querySelectorAll(a){return this.getElementsBy(F(this,r,D).call(this,a))}}return r=new WeakSet,D=function(a){return getCondition(a,this)},t}}}),_AstElement_decorators,_init2,_a,AstElement,init_element=__esm({"lib/element.ts"(){"use strict";var e,K,r;init_string(),init_debug(),init_node(),init_elementLike(),_AstElement_decorators=[elementLike],AstElement=(r=class extends(_a=AstNode){constructor(){super(...arguments);v(this,e)}get length(){return this.childNodes.length}text(s){return text(this.childNodes,s)}removeAt(s){return setChildNodes(this,s,1)[0]}insertAt(s,n=this.length){return setChildNodes(this,n,0,[s]),s}append(...s){this.safeAppend(s)}safeAppend(s){for(const n of s)this.insertAt(n)}replaceChildren(...s){this.safeReplaceChildren(s)}safeReplaceChildren(s){for(let n=this.length-1;n>=0;n--)this.removeAt(n);this.safeAppend(s)}setText(s,n=0){n+=n<0?this.length:0;const a=this.childNodes[n],{data:u}=a;return a.replaceData(s),u}toString(s,n=""){return this.childNodes.map(a=>a.toString(s)).join(n)}removeChild(s){return this.removeAt(F(this,e,K).call(this,s))}},e=new WeakSet,K=function(s){return this.childNodes.indexOf(s)},r),_init2=__decoratorStart(_a),AstElement=__decorateElement(_init2,0,"AstElement",_AstElement_decorators,AstElement),__runInitializers(_init2,1,AstElement)}}),AstText,init_text=__esm({"lib/text.ts"(){"use strict";var e,Y,r;init_node(),AstText=(r=class extends AstNode{constructor(s){super();v(this,e);I(this,"data","");this.data=s}get type(){return"text"}toString(s){return this.data}text(){return this.data}replaceData(s){F(this,e,Y).call(this,s)}},e=new WeakSet,Y=function(s){this.setAttribute("data",s)},r)}}),OnlyincludeToken,init_onlyinclude=__esm({"src/onlyinclude.ts"(){"use strict";init_src(),OnlyincludeToken=class extends Token{get type(){return"onlyinclude"}toString(e){return`<onlyinclude>${super.toString(e)}</onlyinclude>`}isPlain(){return!0}}}}),hiddenToken,init_hidden=__esm({"mixin/hidden.ts"(){"use strict";hiddenToken=(e=!0,t=!0)=>r=>{class i extends r{text(){return""}}return i}}}),NowikiBaseToken,init_base=__esm({"src/nowiki/base.ts"(){"use strict";init_src(),NowikiBaseToken=class extends Token{get innerText(){return this.firstChild.data}constructor(e="",t,r){super(e,t,r)}}}}),_NoincludeToken_decorators,_init3,_a2,NoincludeToken,init_noinclude=__esm({"src/nowiki/noinclude.ts"(){"use strict";init_hidden(),init_base(),_NoincludeToken_decorators=[hiddenToken()],NoincludeToken=class extends(_a2=NowikiBaseToken){get type(){return"noinclude"}toString(e){return e?"":super.toString()}},_init3=__decoratorStart(_a2),NoincludeToken=__decorateElement(_init3,0,"NoincludeToken",_NoincludeToken_decorators,NoincludeToken),__runInitializers(_init3,1,NoincludeToken)}}),TagPairToken,init_tagPair=__esm({"src/tagPair/index.ts"(){"use strict";var e,t;init_src(),TagPairToken=(t=class extends Token{constructor(i,s,n,a,u,h=[]){super(void 0,u);v(this,e);I(this,"closed");I(this,"selfClosing");x(this,e,[i,a||i]),this.closed=a!=="",this.selfClosing=a===void 0,this.append(s,n);const p=typeof s=="string"?-1:h.indexOf(s);h.splice(p===-1?1/0:p,0,this)}toString(i){const{selfClosing:s,firstChild:n,lastChild:a}=this,[u,h]=f(this,e);return s?`<${u}${n.toString(i)}/>`:`<${u}${n.toString(i)}>${a.toString(i)}${this.closed?`</${h}>`:""}`}text(){const[i,s]=f(this,e);return this.selfClosing?`<${i}${this.firstChild.text()}/>`:`<${i}${super.text(">")}${this.closed?`</${s}>`:""}`}},e=new WeakMap,t)}}),_IncludeToken_decorators,_init4,_a3,IncludeToken,init_include=__esm({"src/tagPair/include.ts"(){"use strict";init_hidden(),init_tagPair(),_IncludeToken_decorators=[hiddenToken(!1)],IncludeToken=class extends(_a3=TagPairToken){get type(){return"include"}constructor(e,t="",r,i,s,n){super(e,t,r!=null?r:"",r===void 0||i!=null?i:"",s,n)}toString(e){return e?"":super.toString()}},_init4=__decoratorStart(_a3),IncludeToken=__decorateElement(_init4,0,"IncludeToken",_IncludeToken_decorators,IncludeToken),__runInitializers(_init4,1,IncludeToken)}}),AttributeToken,init_attribute=__esm({"src/attribute.ts"(){"use strict";var e,t,r,i;init_index(),init_src(),AttributeToken=(i=class extends Token{constructor(n,a,u,h="",p,l=[],o=index_default.getConfig(),c=[]){const d=u;let g;if(a==="gallery"&&u==="caption"){const _=W(q({},o),{excludes:[...o.excludes,"heading"]});g=new Token(p,_,c,{}),g.type="attr-value",g.setAttribute("stage",1)}else g=p!=null?p:"";super(void 0,o,c);v(this,e);v(this,t);v(this,r);x(this,e,n),this.append(d,g),x(this,t,h),x(this,r,[...l])}get type(){return f(this,e)}toString(n){const[a="",u=""]=f(this,r);return f(this,t)?super.toString(n,f(this,t)+a)+u:this.firstChild.toString(n)}text(){return f(this,t)?`${super.text(`${f(this,t).trim()}"`)}"`:this.firstChild.text()}},e=new WeakMap,t=new WeakMap,r=new WeakMap,i)}}),toAttributeType,AttributesToken,init_attributes=__esm({"src/attributes.ts"(){"use strict";var e,t;init_string(),init_src(),init_attribute(),toAttributeType=r=>r.slice(0,-1),AttributesToken=(t=class extends Token{constructor(i,s,n,a,u=[]){super(void 0,a,u,{});v(this,e);if(x(this,e,s),i){const h=/([^\s/][^\s/=]*)(?:(\s*=\s*)(?:(["'])([\s\S]*?)(\3|$)|(\S*)))?/gu;let p="",l=h.exec(i),o=0;const c=()=>{p&&(super.insertAt(p),p="")};for(;l;){const{index:d,0:g,1:_,2:k,3:E,4:b,5:A,6:m}=l;if(p+=i.slice(o,d),/^[\w:][\w:.-]*$/u.test(removeComment(_).trim())){const T=b!=null?b:m,C=[E,A],S=new AttributeToken(toAttributeType(s),n,_,k,T,C,a,u);c(),super.insertAt(S)}else p+=g;({lastIndex:o}=h),l=h.exec(i)}p+=i.slice(o),c()}}get type(){return f(this,e)}},e=new WeakMap,t)}}),AtomToken,init_atom=__esm({"src/atom.ts"(){"use strict";var e,t;init_src(),AtomToken=(t=class extends Token{constructor(i,s,n,a,u){super(i,n,a,u);v(this,e);x(this,e,s)}get type(){return f(this,e)}},e=new WeakMap,t)}}),HeadingToken,init_heading=__esm({"src/heading.ts"(){"use strict";var e,t,U,i;init_src(),init_atom(),HeadingToken=(i=class extends Token{constructor(n,a,u,h=[]){super(void 0,u,h);v(this,t);v(this,e);x(this,e,n);const p=new Token(a[0],u,h);p.type="heading-title",p.setAttribute("stage",2);const l=new AtomToken(a[1],"heading-trail",u,h);this.append(p,l)}get type(){return"heading"}get level(){return f(this,e)}toString(n){const a=F(this,t,U).call(this);return a+this.firstChild.toString(n)+a+this.lastChild.toString(n)}text(){const n=F(this,t,U).call(this);return n+this.firstChild.text()+n}},e=new WeakMap,t=new WeakSet,U=function(){return"=".repeat(this.level)},i)}}),ParameterToken,init_parameter=__esm({"src/parameter.ts"(){"use strict";init_string(),init_src(),ParameterToken=class extends Token{get type(){return"parameter"}get anon(){return this.firstChild.length===0}constructor(e,t,r,i=[]){super(void 0,r,i);const s=new Token(typeof e=="number"?void 0:e,r,i,{}),n=new Token(t,r,i);s.type="parameter-key",s.setAttribute("stage",2),n.type="parameter-value",n.setAttribute("stage",2),this.append(s,n)}trimName(e,t=!0){const r=e.toString(!0).replace(/^[ \t\n\0\v]+|([^ \t\n\0\v])[ \t\n\0\v]+$/gu,"$1");return this.setAttribute("name",r),r}afterBuild(){if(!this.anon){const{parentNode:e,firstChild:t}=this,r=this.trimName(t);e&&e.getArgs(r,!1,!1).add(this)}super.afterBuild()}toString(e){return this.anon?this.lastChild.toString(e):super.toString(e,"=")}text(){return this.anon?this.lastChild.text():super.text("=")}getValue(){var t;const e=removeComment(this.lastChild.text());return this.anon&&((t=this.parentNode)==null?void 0:t.isTemplate())!==!1?e:e.trim()}setValue(e){this.lastChild.replaceChildren(e)}}}}),TranscludeToken,init_transclude=__esm({"src/transclude.ts"(){"use strict";var e,t,r,i,s,n,Z,ee,h;init_string(),init_src(),init_parameter(),init_atom(),TranscludeToken=(h=class extends Token{constructor(l,o,c,d=[]){var j,z;let g;const _=/^(?:\s|\0\d+[cn]\x7F)*\0(\d+)h\x7F(?:\s|\0\d+[cn]\x7F)*/u.exec(l);_&&(g=Number(_[1]),l=l.replace(`\0${g}h`,d[g].toString().replace(/^\n/u,"")));super(void 0,c,d,{});v(this,n);I(this,"modifier","");v(this,e,"template");v(this,t,":");v(this,r,!1);v(this,i,new Map);v(this,s);const{parserFunction:[k,E],variable:b,functionHook:A}=c,m=(j=/^(?:\s|\0\d+[cn]\x7F)*\0\d+s\x7F/u.exec(l))==null?void 0:j[0];if(m)this.setAttribute("modifier",m),l=l.slice(m.length);else if(l.includes(":")){const[w,...y]=l.split(":"),[$]=/^(?:\s|\0\d+[cn]\x7F)*/u.exec((z=y[0])!=null?z:"");this.setModifier(`${w}:${$}`)&&(l=y.join(":").slice($.length))}const T=l.search(/[:：]/u),C=l[T]==="：",S=T!==-1;if(S||o.length===0&&!f(this,r)){const w=S?l.slice(0,T):l,y=S&&l.slice(T+1),$=removeComment(w),O=S?$.slice($.search(/\S/u))+(C?"：":""):$.trim(),L=O.toLowerCase(),M=Object.prototype.hasOwnProperty.call(E,O),P=M?E[O]:Object.prototype.hasOwnProperty.call(k,L)&&k[L],R=!("functionHook"in c)||A.includes(P),G=b.includes(P);if(S?P&&R:G){this.setAttribute("name",P||L.replace(/^#|：$/u,"")),x(this,e,"magic-word"),C&&x(this,t,"：");const ie=new AtomToken(w,"magic-word-name",c,d);super.insertAt(ie),y!==!1&&o.unshift([y])}}if(this.type==="template"){const w=removeComment(l).trim();if(!this.normalizeTitle(w,10,{halfParsed:!0,temporary:!0}).valid)throw d.pop(),new SyntaxError("Invalid template name");const y=new AtomToken(l,"template-name",c,d,{});super.insertAt(y)}typeof g=="number"&&(d[g]=void 0);const N=this.isTemplate();let B=1;for(let w=0;w<o.length;w++){const y=o[w];N||(y[0]=y.join("="),y.length=1),y.length===1&&(y.unshift(B),B++),this.insertAt(new ParameterToken(...y,c,d))}}get type(){return f(this,e)}setModifier(l){const{parserFunction:[,,o,c]}=this.getAttribute("config"),g=removeComment(l).trim().slice(0,-1).toLowerCase(),_=o.includes(g),k=c.includes(g);return _||k||!l?(this.setAttribute("modifier",l),x(this,r,_),!!l):!1}isTemplate(){return this.type==="template"}afterBuild(){this.modifier.includes("\0")&&this.setAttribute("modifier",this.buildFromStr(this.modifier,0)),super.afterBuild(),this.isTemplate()&&(x(this,s,F(this,n,Z).call(this)),this.setAttribute("name",f(this,s).title))}toString(l){const{childNodes:o,length:c,firstChild:d,modifier:g,type:_}=this;return`{{${g}${_==="magic-word"?d.toString(l)+(c===1?"":f(this,t))+o.slice(1).map(k=>k.toString(l)).join("|"):super.toString(l,"|")}}}`}text(){const{childNodes:l,length:o,firstChild:c,modifier:d,type:g}=this;return`{{${d}${g==="magic-word"?c.text()+(o===1?"":f(this,t))+text(l.slice(1),"|"):super.text("|")}}}`}insertAt(l,o=this.length){return super.insertAt(l,o),l.anon?F(this,n,ee).call(this,l):l.name&&this.getArgs(l.name,!1,!1).add(l),l}getAllArgs(){return this.childNodes.slice(1)}getAnonArgs(){return this.getAllArgs().filter(({anon:l})=>l)}getArgs(l,o,c=!0){const d=String(l).replace(/^[ \t\n\0\v]+|([^ \t\n\0\v])[ \t\n\0\v]+$/gu,"$1");let g;return f(this,i).has(d)?g=f(this,i).get(d):(g=new Set(this.getAllArgs().filter(({name:_})=>d===_)),f(this,i).set(d,g)),g}getArg(l){const{childNodes:o}=this;return[...this.getArgs(l)].sort((c,d)=>o.indexOf(d)-o.indexOf(c))[0]}getValue(l){var o;return(o=this.getArg(l))==null?void 0:o.getValue()}setValue(l,o){const c=this.getArg(l);c?c.setValue(o):this.insertAt(new ParameterToken(String(l),o,this.getAttribute("config")))}},e=new WeakMap,t=new WeakMap,r=new WeakMap,i=new WeakMap,s=new WeakMap,n=new WeakSet,Z=function(){return this.normalizeTitle(this.childNodes[0].text(),10,{temporary:!0})},ee=function(l){const o=this.getAnonArgs(),c=l,d=String(o.length);c.setAttribute("name",d),this.getArgs(d,!1,!1).add(c)},h)}}),_HiddenToken_decorators,_init5,_a4,HiddenToken,init_hidden2=__esm({"src/hidden.ts"(){"use strict";init_hidden(),init_src(),_HiddenToken_decorators=[hiddenToken()],HiddenToken=class extends(_a4=Token){get type(){return"hidden"}},_init5=__decoratorStart(_a4),HiddenToken=__decorateElement(_init5,0,"HiddenToken",_HiddenToken_decorators,HiddenToken),__runInitializers(_init5,1,HiddenToken)}}),ArgToken,init_arg=__esm({"src/arg.ts"(){"use strict";init_string(),init_src(),init_atom(),init_hidden2(),ArgToken=class extends Token{get type(){return"arg"}constructor(e,t,r=[]){super(void 0,t,r,{});for(let i=0;i<e.length;i++){const s=e[i];if(i===0){const n=new AtomToken(s,"arg-name",t,r,{});super.insertAt(n)}else if(i>1){const n=new HiddenToken(s,t,r);super.insertAt(n)}else{const n=new Token(s,t,r);n.type="arg-default",n.setAttribute("stage",2),super.insertAt(n)}}}toString(e){return`{{{${super.toString(e,"|")}}}}`}text(){return`{{{${text(this.childNodes.slice(0,2),"|")}}}}`}}}}),braces_exports={};__export(braces_exports,{parseBraces:()=>parseBraces});var closes,lbrack,newline,openBraces,marks,getExecRegex,reReplace,getSymbol,parseBraces,init_braces=__esm({"parser/braces.ts"(){"use strict";init_dist(),init_string(),init_heading(),init_transclude(),init_arg(),closes={"=":String.raw`\n(?!(?:[^\S\n]|\0\d+[cn]\x7F)*\n)`,"{":String.raw`\}{2,}|\|`,"-":String.raw`\}-`,"[":String.raw`\]\]`},lbrack=String.raw`\[(?!\[)`,newline=String.raw`\n(?![=\0])`,openBraces=String.raw`|\{{2,}`,marks=new Map([["!","!"],["!!","+"],["(!","{"],["!)","}"],["!-","-"],["=","~"],["server","m"]]),getExecRegex=getRegex(e=>new RegExp(e,"gmu")),reReplace=new RegExp(String.raw`\{\{((?:[^\n{}[]|${lbrack}|${newline})*)\}\}(?!\})`+"|"+String.raw`\[\[(?:[^\n[\]{]|${newline})*\]\]`+"|"+String.raw`-\{(?:[^\n{}[]|${lbrack}|${newline})*\}-`,"gu"),getSymbol=e=>{const t=trimLc(removeComment(e));return marks.has(t)?marks.get(t):/^(?:filepath|(?:full|canonical)urle?):./u.test(t)?"m":"t"},parseBraces=(e,t,r)=>{var g,_,k,E,b;const i=String.raw`${t.excludes.includes("heading")?"":String.raw`^((?:\0\d+[cno]\x7F)*)={1,6}|`}\[\[|-\{(?!\{)`,{parserFunction:[,,,s]}=t,n=[],a=[],u=(A,m,T,C)=>{m[m.length-1].push(restore(A.slice(T,C),a))};let h;do h!==void 0&&(e=h),h=e.replace(reReplace,(A,m,T)=>{if(m!==void 0||typeof T=="string")try{const{length:C}=r,S=(m!=null?m:T).split("|");return new TranscludeToken(restore(S[0],a),S.slice(1).map(N=>{const B=N.indexOf("=");return(B===-1?[N]:[N.slice(0,B),N.slice(B+1)]).map(j=>restore(j,a))}),t,r),`\0${C}${getSymbol(S[0])}`}catch(C){if(!(C instanceof SyntaxError)||C.message!=="Invalid template name")throw C}return a.push(restore(A,a)),`\0${a.length-1}`});while(h!==e);e=h;const p=e.lastIndexOf("}}")-e.length;let l=p+e.length!==-1,o=getExecRegex(i+(l?openBraces:"")),c=o.exec(e),d;for(;c||d!==void 0&&d<=e.length&&((_=(g=n[n.length-1])==null?void 0:g[0])!=null&&_.startsWith("="));){if(c!=null&&c[1]){const[,{length:y}]=c;c[0]=c[0].slice(y),c.index+=y}const{0:A,index:m}=c!=null?c:{0:`
`,index:e.length},T=(k=n.pop())!=null?k:{},{0:C,index:S,parts:N,findEqual:B,pos:j}=T,z=A==="="&&B;if(A==="]]"||A==="}-")d=m+2;else if(A===`
`){d=m+1;const{pos:y,findEqual:$}=(E=n[n.length-1])!=null?E:{};if(y===void 0||$||removeComment(e.slice(y,S))!==""){const O=/^(={1,6})(.+)\1((?:\s|\0\d+[cn]\x7F)*)$/u.exec(e.slice(S,m));O&&(O[2]=restore(O[2],a),O[2].includes(`
`)||(e=`${e.slice(0,S)}\0${r.length}h${e.slice(m)}`,d=S+4+String(r.length).length,new HeadingToken(O[1].length,O.slice(2),t,r)))}}else if(A==="|"||z)d=m+1,u(e,N,j,m),A==="|"&&N.push([]),T.pos=d,T.findEqual=A==="|",n.push(T);else if(A.startsWith("}}")){const y=A.slice(0,Math.min(C.length,3)),$=C.length-y.length,{length:O}=r;d=m+y.length,u(e,N,j,m);let L=!1,M="t";if(y.length===3){const P=N.map(G=>G.join("=")),R=P.length>1&&removeComment(P[1]).trim();new ArgToken(P,t,r),R&&R.endsWith(":")&&s.includes(R.slice(0,-1).toLowerCase())&&(M="s")}else try{new TranscludeToken(N[0][0],N.slice(1),t,r),M=getSymbol(N[0][0])}catch(P){if(P instanceof SyntaxError&&P.message==="Invalid template name")L=!0;else throw P}L||(e=`${e.slice(0,S+$)}\0${O}${M}${e.slice(d)}`,d=S+$+3+String(O).length,$>1?n.push({0:C.slice(0,$),index:S,pos:S+$,parts:[[]]}):$===1&&e[S-1]==="-"&&n.push({0:"-{",index:S-1,pos:S+1,parts:[[]]}))}else d=m+A.length,A.startsWith("{")&&(c.pos=d,c.parts=[[]]),n.push(..."0"in T?[T]:[],c);let w=n[n.length-1];if(l&&p+e.length<d)for(l=!1;(b=w==null?void 0:w[0])!=null&&b.startsWith("{");)n.pop(),w=n[n.length-1];o=getExecRegex(i+(l?openBraces:"")+(w?`|${closes[w[0][0]]}${w.findEqual?"|=":""}`:"")),o.lastIndex=d,c=o.exec(e)}return restore(e,a)}}}),nested_exports={};__export(nested_exports,{NestedToken:()=>NestedToken});var NestedToken,init_nested=__esm({"src/nested.ts"(){"use strict";init_commentAndExt(),init_braces(),init_src(),NestedToken=class extends Token{get type(){return"ext-inner"}constructor(e,t,r,i,s=[]){const n=Symbol("NestedToken"),{length:a}=s;s.push(n),e&&(e=parseCommentAndExt(e,i,s,t)),e&&(e=parseBraces(e,i,s)),s.splice(a,1),super(e,i,s)}}}}),multiLine,init_multiLine=__esm({"mixin/multiLine.ts"(){"use strict";multiLine=e=>{class t extends e{toString(i){return super.toString(i,`
`)}text(){return super.text(`
`).replace(/\n\s*\n/gu,`
`)}}return t}}}),LinkBaseToken,init_base2=__esm({"src/link/base.ts"(){"use strict";var e,t;init_src(),LinkBaseToken=(t=class extends Token{constructor(i,s,n,a=[],u="|"){super(void 0,n,a,{});v(this,e);this.insertAt(i),x(this,e,u)}toString(i){return super.toString(i,f(this,e))}text(){return super.text("|")}},e=new WeakMap,t)}}),ImageParameterToken,init_imageParameter=__esm({"src/imageParameter.ts"(){"use strict";init_src(),ImageParameterToken=class extends Token{get type(){return"image-parameter"}}}}),FileToken,init_file=__esm({"src/link/file.ts"(){"use strict";init_base2(),init_imageParameter(),FileToken=class extends LinkBaseToken{constructor(e,t,r,i=[],s="|"){super(e,void 0,r,i,s),t!==void 0&&this.append(new ImageParameterToken(t,r,i))}}}}),GalleryImageToken,init_galleryImage=__esm({"src/link/galleryImage.ts"(){"use strict";init_constants(),init_src(),init_file(),GalleryImageToken=class extends FileToken{constructor(t,r,i,s,n=[]){let a;if(i!==void 0){const{length:u}=n;a=new Token(i,s,n);for(let h=0;h<MAX_STAGE;h++)a.parseOnce();n.splice(u,1)}super(r,a==null?void 0:a.toString(),s,n);I(this,"privateType","imagemap-image");this.privateType=`${t}-image`}get type(){return this.privateType}}}}),gallery_exports={};__export(gallery_exports,{GalleryToken:()=>GalleryToken});var _GalleryToken_decorators,_init6,_a5,GalleryToken,init_gallery=__esm({"src/gallery.ts"(){"use strict";var e,te,r;init_multiLine(),init_src(),init_galleryImage(),_GalleryToken_decorators=[multiLine],GalleryToken=(r=class extends(_a5=Token){constructor(s,n,a=[]){var u;super(void 0,n,a,{});v(this,e);for(const h of(u=s==null?void 0:s.split(`
`))!=null?u:[]){const p=/^([^|]+)(?:\|(.*))?/u.exec(h);if(!p){super.insertAt(h);continue}const[,l,o]=p;F(this,e,te).call(this,l)?super.insertAt(new GalleryImageToken("gallery",l,o,n,a)):super.insertAt(h)}}get type(){return"ext-inner"}},e=new WeakSet,te=function(s){return this.normalizeTitle(s,6,{halfParsed:!0,temporary:!0,decode:!0}).valid},r),_init6=__decoratorStart(_a5),GalleryToken=__decorateElement(_init6,0,"GalleryToken",_GalleryToken_decorators,GalleryToken),__runInitializers(_init6,1,GalleryToken)}}),imagemap_exports={};__export(imagemap_exports,{ImagemapToken:()=>ImagemapToken});var _ImagemapToken_decorators,_init7,_a6,ImagemapToken,init_imagemap=__esm({"src/imagemap.ts"(){"use strict";init_multiLine(),init_index(),init_src(),init_galleryImage(),_ImagemapToken_decorators=[multiLine],ImagemapToken=class extends(_a6=Token){get type(){return"ext-inner"}constructor(e,t=index_default.getConfig(),r=[]){if(super(void 0,t,r,{}),!e)return;const i=e.split(`
`);let s=!0,n=!1;for(const a of i){const u=a.trim();if(!(n||!u||u.startsWith("#"))){if(s){const h=a.indexOf("|"),p=h===-1?a:a.slice(0,h),{valid:l,ns:o}=this.normalizeTitle(p,0,{halfParsed:!0,temporary:!0});if(l&&o===6){const c=new GalleryImageToken("imagemap",p,h===-1?void 0:a.slice(h+1),t,r);super.insertAt(c),s=!1;continue}else n=!0}}super.insertAt(a)}}},_init7=__decoratorStart(_a6),ImagemapToken=__decorateElement(_init7,0,"ImagemapToken",_ImagemapToken_decorators,ImagemapToken),__runInitializers(_init7,1,ImagemapToken)}}),nowiki_exports={};__export(nowiki_exports,{NowikiToken:()=>NowikiToken});var NowikiToken,init_nowiki=__esm({"src/nowiki/index.ts"(){"use strict";init_base(),NowikiToken=class extends NowikiBaseToken{get type(){return"ext-inner"}}}}),ExtToken,init_ext=__esm({"src/tagPair/ext.ts"(){"use strict";init_index(),init_src(),init_tagPair(),init_attributes(),ExtToken=class extends TagPairToken{get type(){return"ext"}constructor(e,t,r,i,s=index_default.getConfig(),n=!1,a=[]){const u=e.toLowerCase(),h=new AttributesToken(!t||/^\s/u.test(t)?t:` ${t}`,"ext-attrs",u,s,a),p=W(q({},s),{ext:s.ext.filter(o=>o!==u),excludes:[...s.excludes]});let l;switch(u){case"indicator":case"poem":case"ref":case"seo":case"langconvert":case"phonos":u==="poem"&&p.excludes.push("heading"),l=new Token(r,p,a);break;case"references":{const{NestedToken:o}=(init_nested(),__toCommonJS(nested_exports));p.excludes.push("heading"),l=new o(r,n,["ref"],p,a);break}case"gallery":{const{GalleryToken:o}=(init_gallery(),__toCommonJS(gallery_exports));l=new o(r,p,a);break}case"imagemap":{const{ImagemapToken:o}=(init_imagemap(),__toCommonJS(imagemap_exports));l=new o(r,p,a);break}default:{const{NowikiToken:o}=(init_nowiki(),__toCommonJS(nowiki_exports));l=new o(r,p,a)}}l.setAttribute("name",u),l.type==="plain"&&(l.type="ext-inner"),super(e,h,l,i,s,a)}}}}),_CommentToken_decorators,_init8,_a7,CommentToken,init_comment=__esm({"src/nowiki/comment.ts"(){"use strict";init_hidden(),init_base(),_CommentToken_decorators=[hiddenToken(!1)],CommentToken=class extends(_a7=NowikiBaseToken){constructor(t,r,i,s){super(t,i,s);I(this,"closed");this.closed=r}get type(){return"comment"}toString(t){return t?"":`<!--${this.innerText}${this.closed?"-->":""}`}},_init8=__decoratorStart(_a7),CommentToken=__decorateElement(_init8,0,"CommentToken",_CommentToken_decorators,CommentToken),__runInitializers(_init8,1,CommentToken)}}),commentAndExt_exports={};__export(commentAndExt_exports,{parseCommentAndExt:()=>parseCommentAndExt});var onlyincludeLeft,onlyincludeRight,length,getRegex2,update,parseCommentAndExt,init_commentAndExt=__esm({"parser/commentAndExt.ts"(){"use strict";init_dist(),init_onlyinclude(),init_noinclude(),init_include(),init_ext(),init_comment(),onlyincludeLeft="<onlyinclude>",onlyincludeRight="</onlyinclude>",{length}=onlyincludeLeft,getRegex2=[!1,!0].map(e=>{const t=e?"includeonly":"(?:no|only)include",r=e?"noinclude":"includeonly";return getObjRegex(i=>new RegExp(String.raw`<!--[\s\S]*?(?:-->|$)|<${t}(?:\s[^>]*)?/?>|</${t}\s*>|<(${i.join("|")})(\s[^>]*?)?(?:/>|>([\s\S]*?)</(${"\\1"}\s*)>)|<(${r})(\s[^>]*?)?(?:/>|>([\s\S]*?)(?:</(${r}\s*)>|$))`,"giu"))}),update=e=>{const t=e.indexOf(onlyincludeLeft);return{i:t,j:e.indexOf(onlyincludeRight,t+length)}},parseCommentAndExt=(e,t,r,i)=>{if(i){let{i:u,j:h}=update(e);if(u!==-1&&h!==-1){let p="";const l=o=>{new NoincludeToken(o,t,r),p+=`\0${r.length-1}n`};for(;u!==-1&&h!==-1;){const o=`\0${r.length}e`;new OnlyincludeToken(e.slice(u+length,h),t,r),u>0&&l(e.slice(0,u)),p+=o,e=e.slice(h+length+1),{i:u,j:h}=update(e)}return e&&l(e),p}}const{ext:s}=t,n=s.filter(u=>u!=="translate"&&u!=="tvar"),a=W(q({},t),{ext:n});return e.replace(getRegex2[i?1:0](n),(u,h,p,l,o,c,d,g,_)=>{const k=r.length;let E="n";if(h)E="e",new ExtToken(h,p,l,o,a,c,r);else if(u.startsWith("<!--")){E="c";const b=u.endsWith("-->");new CommentToken(u.slice(4,b?-3:void 0),b,t,r)}else c?new IncludeToken(c,d,g,_,t,r):new NoincludeToken(u,t,r);return`\0${k}${E}`})}}}),src_exports={};__export(src_exports,{Token:()=>Token});var Token,init_src=__esm({"src/index.ts"(){"use strict";var e,t,r,i,s,n,se,re,h;init_string(),init_constants(),init_debug(),init_index(),init_element(),init_text(),Token=(h=class extends AstElement{constructor(o,c=index_default.getConfig(),d=[],g){super();v(this,n);v(this,e,"plain");v(this,t,0);v(this,r);v(this,i);v(this,s);typeof o=="string"&&this.insertAt(o),x(this,r,c),x(this,i,d),d.push(this)}get type(){return f(this,e)}set type(o){x(this,e,o)}parseOnce(o=f(this,t),c=!1,d){if(o<f(this,t)||this.length===0||!this.isPlain())return this;if(f(this,t)>=MAX_STAGE)return this;switch(o){case 0:this.type==="root"&&f(this,i).pop(),x(this,s,c),F(this,n,se).call(this,c);break;case 1:F(this,n,re).call(this)}if(this.type==="root")for(const g of f(this,i))g==null||g.parseOnce(o,c,d);return Q(this,t)._++,this}buildFromStr(o,c){const d=o.split(/[\0\x7F]/u).map((g,_)=>{if(_%2===0)return new AstText(g);if(isNaN(g.slice(-1)))return f(this,i)[Number(g.slice(0,-1))];throw new Error(`Failed to build! Unrecognized token: ${g}`)});return c===0?d.map(String).join(""):c===1?text(d):d}build(){x(this,t,MAX_STAGE);const{length:o,firstChild:c}=this,d=c==null?void 0:c.toString();if(o===1&&c.type==="text"&&d.includes("\0")&&(setChildNodes(this,0,1,this.buildFromStr(d)),this.type==="root"))for(const g of f(this,i))g==null||g.build()}afterBuild(){if(this.type==="root")for(const o of f(this,i))o==null||o.afterBuild()}parse(o=MAX_STAGE,c,d){for(o=Math.min(o,MAX_STAGE);f(this,t)<o;)this.parseOnce(f(this,t),c,d);return o&&(this.build(),this.afterBuild()),this}isPlain(){return this.constructor===h}getAttribute(o){switch(o){case"config":return f(this,r);default:return super.getAttribute(o)}}setAttribute(o,c){switch(o){case"stage":f(this,t)===0&&this.type==="root"&&f(this,i).shift(),x(this,t,c);break;default:super.setAttribute(o,c)}}insertAt(o,c=this.length){const d=typeof o=="string"?new AstText(o):o;super.insertAt(d,c);const{type:g}=d;return g==="root"&&(d.type="plain"),d}normalizeTitle(o,c=0,d){return index_default.normalizeTitle(o,c,f(this,s),f(this,r),d)}},e=new WeakMap,t=new WeakMap,r=new WeakMap,i=new WeakMap,s=new WeakMap,n=new WeakSet,se=function(o){const{parseCommentAndExt:c}=(init_commentAndExt(),__toCommonJS(commentAndExt_exports));this.setText(c(this.firstChild.toString(),f(this,r),f(this,i),o))},re=function(){const{parseBraces:o}=(init_braces(),__toCommonJS(braces_exports)),c=this.type==="root"?this.firstChild.toString():`\0${this.firstChild.toString()}`,d=o(c,f(this,r),f(this,i));this.setText(this.type==="root"?d:d.slice(1))},h)}}),index_exports={};__export(index_exports,{default:()=>index_default}),module.exports=__toCommonJS(index_exports);var Parser,index_default,init_index=__esm({"index.ts"(){init_constants(),init_string(),Parser={getConfig(e){const t=e!=null?e:this.config;return W(q(q({},minConfig),t),{excludes:[]})},normalizeTitle(e,t=0,r,i=Parser.getConfig(),s){const{Title:n}=(init_title(),__toCommonJS(title_exports));let a;if(s!=null&&s.halfParsed)a=new n(e,t,i,s);else{const{Token:u}=(init_src(),__toCommonJS(src_exports));a=(()=>{const h=new u(e,i);h.type="root",h.parseOnce(0,r).parseOnce();const p=new n(h.toString(),t,i,s);h.build();const l=p.main;if(l.includes("\0")){const o=h.buildFromStr(l,1);p.main=o}return p})()}return a},parse(e,t,r=MAX_STAGE,i=Parser.getConfig()){e=tidy(e);const{Token:s}=(init_src(),__toCommonJS(src_exports));return(()=>{const a=new s(e,i);return a.type="root",a.parse(r,t)})()}},index_default=Parser}});init_index();
//# sourceMappingURL=bundle.min.js.map
