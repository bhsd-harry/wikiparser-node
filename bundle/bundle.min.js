"use strict";var it=Object.defineProperty,nt=Object.defineProperties;var at=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var ot=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var X=t=>{throw TypeError(t)};var H=(t,e,s)=>e in t?it(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,M=(t,e)=>{for(var s in e||(e={}))ot.call(e,s)&&H(t,s,e[s]);if(J)for(var s of J(e))lt.call(e,s)&&H(t,s,e[s]);return t},z=(t,e)=>nt(t,at(e));var I=(t,e,s)=>H(t,typeof e!="symbol"?e+"":e,s),D=(t,e,s)=>e.has(t)||X("Cannot "+s);var f=(t,e,s)=>(D(t,e,"read from private field"),s?s.call(t):e.get(t)),x=(t,e,s)=>e.has(t)?X("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),b=(t,e,s,i)=>(D(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),E=(t,e,s)=>(D(t,e,"access private method"),s);var Q=(t,e,s,i)=>({set _(r){b(t,e,r,s)},get _(){return f(t,e,i)}});var __create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__knownSymbol=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),__typeError=t=>{throw TypeError(t)},__defNormalProp=(t,e,s)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,__name=(t,e)=>__defProp(t,"name",{value:e,configurable:!0}),__esm=(t,e)=>function(){return t&&(e=(0,t[__getOwnPropNames(t)[0]])(t=0)),e},__commonJS=(t,e)=>function(){return e||(0,t[__getOwnPropNames(t)[0]])((e={exports:{}}).exports,e),e.exports},__export=(t,e)=>{for(var s in e)__defProp(t,s,{get:e[s],enumerable:!0})},__copyProps=(t,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of __getOwnPropNames(e))!__hasOwnProp.call(t,r)&&r!==s&&__defProp(t,r,{get:()=>e[r],enumerable:!(i=__getOwnPropDesc(e,r))||i.enumerable});return t},__toCommonJS=t=>__copyProps(__defProp({},"__esModule",{value:!0}),t),__decoratorStart=t=>{var e;return[,,,__create((e=t==null?void 0:t[__knownSymbol("metadata")])!=null?e:null)]},__decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=t=>t!==void 0&&typeof t!="function"?__typeError("Function expected"):t,__decoratorContext=(t,e,s,i,r)=>({kind:__decoratorStrings[t],name:e,metadata:i,addInitializer:n=>s._?__typeError("Already initialized"):r.push(__expectFn(n||null))}),__decoratorMetadata=(t,e)=>__defNormalProp(e,__knownSymbol("metadata"),t[3]),__runInitializers=(t,e,s,i)=>{for(var r=0,n=t[e>>1],a=n&&n.length;r<a;r++)e&1?n[r].call(s):i=n[r].call(s,i);return i},__decorateElement=(t,e,s,i,r,n)=>{var a,h,u,p,l,o=e&7,c=!!(e&8),d=!!(e&16),g=o>3?t.length+1:o?c?1:2:0,y=__decoratorStrings[o+5],T=o>3&&(t[g-1]=[]),N=t[g]||(t[g]=[]),_=o&&(!d&&!c&&(r=r.prototype),o<5&&(o>3||!d)&&__getOwnPropDesc(o<4?r:{get[s](){return __privateGet(this,n)},set[s](m){return __privateSet(this,n,m)}},s));o?d&&o<4&&__name(n,(o>2?"set ":o>1?"get ":"")+s):__name(r,s);for(var v=i.length-1;v>=0;v--)p=__decoratorContext(o,s,u={},t[3],N),o&&(p.static=c,p.private=d,l=p.access={has:d?m=>__privateIn(r,m):m=>s in m},o^3&&(l.get=d?m=>(o^1?__privateGet:__privateMethod)(m,r,o^4?n:_.get):m=>m[s]),o>2&&(l.set=d?(m,A)=>__privateSet(m,r,A,o^4?n:_.set):(m,A)=>m[s]=A)),h=(0,i[v])(o?o<4?d?n:_[y]:o>4?void 0:{get:_.get,set:_.set}:r,p),u._=1,o^4||h===void 0?__expectFn(h)&&(o>4?T.unshift(h):o?d?n=h:_[y]=h:r=h):typeof h!="object"||h===null?__typeError("Object expected"):(__expectFn(a=h.get)&&(_.get=a),__expectFn(a=h.set)&&(_.set=a),__expectFn(a=h.init)&&T.unshift(a));return o||__decoratorMetadata(t,r),_&&__defProp(r,s,_),d?o^4?n:_:r},__accessCheck=(t,e,s)=>e.has(t)||__typeError("Cannot "+s),__privateIn=(t,e)=>Object(e)!==e?__typeError('Cannot use the "in" operator on this value'):t.has(e),__privateGet=(t,e,s)=>(__accessCheck(t,e,"read from private field"),s?s.call(t):e.get(t)),__privateSet=(t,e,s,i)=>(__accessCheck(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),__privateMethod=(t,e,s)=>(__accessCheck(t,e,"access private method"),s),Shadow,setChildNodes,getMagicWordInfo,init_debug=__esm({"util/debug.ts"(){"use strict";Shadow={run(t,e){return t()}},setChildNodes=(t,e,s,i=[])=>{var a,h;let r=t.getChildNodes(),n;r.length===s?(n=r,r=i):n=Array.prototype.splice.apply(r,[e,s,...i]);for(let u=0;u<i.length;u++){const p=i[u];p.setAttribute("parentNode",t),p.setAttribute("nextSibling",r[e+u+1]),p.setAttribute("previousSibling",r[e+u-1])}return(a=r[e-1])==null||a.setAttribute("nextSibling",r[e]),(h=r[e+i.length])==null||h.setAttribute("previousSibling",r[e+i.length-1]),r===i&&t.setAttribute("childNodes",r),n},getMagicWordInfo=(t,e)=>{const s=t.toLowerCase(),[i,r]=e,n=Object.prototype.hasOwnProperty.call(r,t);return[s,n,n?r[t]:Object.prototype.hasOwnProperty.call(i,s)&&i[s]]}}}),require_minimum=__commonJS({"config/minimum.json"(t,e){e.exports={ext:[],namespaces:{0:"",6:"File",10:"Template"},nsid:{"":0,file:6,template:10},functionHook:[],variable:["!","="],parserFunction:[{},{"!":"!","=":"="},["msg","raw"],["subst","safesubst"]]}}}),MAX_STAGE,minConfig,init_constants=__esm({"util/constants.ts"(){"use strict";MAX_STAGE=2,minConfig=require_minimum()}});function restore(t,e){return t.replace(/\0(\d+)\x7F/gu,(s,i)=>e[i])}var trimLc,factory,tidy,removeComment,text,names,decodeHtmlBasic,decodeHtmlResolved,decodeHtml,init_string=__esm({"util/string.ts"(){"use strict";trimLc=t=>t.trim().toLowerCase(),factory=(t,e)=>s=>s.replace(t,e),tidy=factory(/[\0\x7F]|\r$/gmu,""),removeComment=factory(/\0\d+[cn]\x7F/gu,""),text=(t,e="")=>t.map(s=>typeof s=="string"?s:s.text()).join(e),names={lt:"<",gt:">",lbrack:"[",rbrack:"]",lbrace:"{",rbrace:"}",nbsp:" ",amp:"&",quot:'"'},decodeHtmlBasic=factory(/&(?:#(\d+|[Xx][\da-fA-F]+)|([lg]t|[LG]T|[lr]brac[ke]|nbsp|amp|AMP|quot|QUOT));/gu,(t,e,s)=>e?String.fromCodePoint(+((/^x/iu.test(e)?"0":"")+e)):names[s.toLowerCase()]),decodeHtml=t=>(decodeHtmlResolved!=null||(decodeHtmlResolved=decodeHtmlBasic),decodeHtmlResolved(t))}});function getRegex(t){const e=new Map,s=new WeakMap;return i=>{const r=typeof i=="string"?e:s;if(r.has(i)){const a=r.get(i);return a.lastIndex=0,a}const n=t(i);return r.set(i,n),n}}var rawurldecode,init_dist=__esm({"../common/dist/index.mjs"(){"use strict";rawurldecode=t=>decodeURIComponent(t.replace(/%(?![\da-f]{2})/giu,"%25"))}}),resolve,Title,init_title=__esm({"lib/title.ts"(){"use strict";var t,e,s,i,K,n;init_dist(),init_string(),resolve=a=>{const[,{length:h},u]=/^((?:\.\.\/)*)([\s\S]*)/u.exec(a);return[h/3,u]},Title=(n=class{constructor(a,h,u,{temporary:p,decode:l,selfLink:o,page:c}={}){x(this,i);x(this,t);x(this,e);x(this,s);I(this,"valid");const d=a.trim(),g=d.startsWith("../");if(l&&a.includes("%"))try{a=rawurldecode(a)}catch(_){}if(a=decodeHtml(a).replace(/[_ ]+/gu," ").trim(),g)b(this,s,0);else{let _=h;a.startsWith(":")&&(_=0,a=a.slice(1).trim());const v=a.split(":");if(v.length>1){const m=trimLc(v[0]),A=Object.prototype.hasOwnProperty.call(u.nsid,m)&&u.nsid[m];A&&(_=A,a=v.slice(1).join(":").trim())}b(this,s,_)}const y=a.indexOf("#");y!==-1&&(a=a.slice(0,y).trim());const[T,N]=g?resolve(a):[0,a];this.valid=!!a&&decodeHtml(a)===a&&!/^:|\0\d+[eh!+-]\x7F|[<>[\]{}|\n]|%[\da-f]{2}|(?:^|\/)\.{1,2}(?:$|\/)/iu.test(N),this.main=a,b(this,e,u.namespaces)}get ns(){return f(this,s)}get main(){return f(this,t)}set main(a){a=a.replace(/_/gu," ").trim(),b(this,t,a&&a[0].toUpperCase()+a.slice(1))}get prefix(){const a=f(this,e)[this.ns];return a+(a&&":")}get title(){return this.getRedirection()[1]}getRedirection(){const{prefix:a}=this,h=a;return E(this,i,K).call(this,h)}},t=new WeakMap,e=new WeakMap,s=new WeakMap,i=new WeakSet,K=function(a){let h=(a+this.main).replace(/ /gu,"_");return h.startsWith("/")&&(h=h.replace(/(.)\/$/u,"$1")),[!1,h]},n)}}),nodeLike,init_nodeLike=__esm({"mixin/nodeLike.ts"(){"use strict";nodeLike=t=>{class e extends t{get firstChild(){return this.childNodes[0]}get lastChild(){return this.childNodes[this.childNodes.length-1]}}return e}}}),_AstNode_decorators,_init,AstNode,init_node=__esm({"lib/node.ts"(){"use strict";var t,e,s,i;init_nodeLike(),_AstNode_decorators=[nodeLike],AstNode=(i=class{constructor(){I(this,"childNodes",[]);x(this,t);x(this,e);x(this,s)}get parentNode(){return f(this,t)}get nextSibling(){return f(this,e)}get previousSibling(){return f(this,s)}getChildNodes(){const{childNodes:r}=this;return r}getAttribute(r){return r==="padding"?0:this[r]}setAttribute(r,n){switch(r){case"parentNode":b(this,t,n),n||(b(this,e,void 0),b(this,s,void 0));break;case"nextSibling":b(this,e,n);break;case"previousSibling":b(this,s,n);break;default:this[r]=n}}insertAdjacent(r,n){const{parentNode:a}=this;if(!a)throw new Error("There is no parent node!");const h=a.childNodes.indexOf(this)+n;for(let u=0;u<r.length;u++)a.insertAt(r[u],h+u)}after(...r){this.insertAdjacent(r,1)}before(...r){this.insertAdjacent(r,0)}remove(r){const{parentNode:n,nextSibling:a,previousSibling:h}=this,u=n==null?void 0:n.childNodes.indexOf(this);n==null||n.removeAt(u),r&&(a==null?void 0:a.type)==="text"&&(h==null?void 0:h.type)==="text"&&a.data.startsWith(`
`)&&h.data.endsWith(`
`)&&a.deleteData(0,1)}},t=new WeakMap,e=new WeakMap,s=new WeakMap,i),_init=__decoratorStart(null),AstNode=__decorateElement(_init,0,"AstNode",_AstNode_decorators,AstNode),__runInitializers(_init,1,AstNode)}}),basic,getCondition,init_selector=__esm({"util/selector.ts"(){"use strict";basic=t=>{if(t.includes("#")){const e=t.indexOf("#"),s=t.slice(0,e),i=t.slice(e+1);return(r,n)=>(e===0||r===s)&&n===i}return e=>e===t},getCondition=(t,e,s)=>{t=t.trim();const i=t.split(",").map(r=>r.trim()).filter(r=>r!=="").map(basic);return(({type:r,name:n})=>i.some(a=>a(r,n)))}}}),elementLike,init_elementLike=__esm({"mixin/elementLike.ts"(){"use strict";init_selector(),elementLike=t=>{var s,G;class e extends t{constructor(){super(...arguments);x(this,s)}getElementBy(a){const h=[...this.childNodes].reverse();for(;h.length>0;){const u=h.pop(),{type:p,childNodes:l}=u;if(p!=="text"){if(a(u))return u;for(let o=l.length-1;o>=0;o--)h.push(l[o])}}}querySelector(a){return this.getElementBy(E(this,s,G).call(this,a))}getElementsBy(a){const h=[...this.childNodes].reverse(),u=[];for(;h.length>0;){const p=h.pop(),{type:l,childNodes:o}=p;if(l!=="text"){a(p)&&u.push(p);for(let c=o.length-1;c>=0;c--)h.push(o[c])}}return u}querySelectorAll(a){return this.getElementsBy(E(this,s,G).call(this,a))}}return s=new WeakSet,G=function(a){return getCondition(a,this)},e}}}),_AstElement_decorators,_init2,_a,AstElement,init_element=__esm({"lib/element.ts"(){"use strict";init_string(),init_debug(),init_node(),init_elementLike(),_AstElement_decorators=[elementLike],AstElement=class extends(_a=AstNode){get length(){return this.childNodes.length}text(t){return text(this.childNodes,t)}removeAt(t){return setChildNodes(this,t,1)[0]}insertAt(t,e=this.length){return setChildNodes(this,e,0,[t]),t}append(...t){this.safeAppend(t)}safeAppend(t){for(const e of t)this.insertAt(e)}safeReplaceChildren(t){for(let e=this.length-1;e>=0;e--)this.removeAt(e);this.safeAppend([...t])}setText(t,e=0){e+=e<0?this.length:0;const s=this.childNodes[e],{data:i}=s;return s.replaceData(t),i}toString(t,e=""){return this.childNodes.map(s=>s.toString(t)).join(e)}replaceChildren(...t){this.safeReplaceChildren(t)}},_init2=__decoratorStart(_a),AstElement=__decorateElement(_init2,0,"AstElement",_AstElement_decorators,AstElement),__runInitializers(_init2,1,AstElement)}}),AstText,init_text=__esm({"lib/text.ts"(){"use strict";var t,V,s;init_node(),AstText=(s=class extends AstNode{constructor(r){super();x(this,t);I(this,"data","");this.data=r}get type(){return"text"}toString(r){return this.data}text(){return this.data}replaceData(r){E(this,t,V).call(this,r)}deleteData(r,n=1/0){E(this,t,V).call(this,this.data.slice(0,r)+(r<0&&r+n>=0?"":this.data.slice(r+n)))}},t=new WeakSet,V=function(r){this.setAttribute("data",r)},s)}}),OnlyincludeToken,init_onlyinclude=__esm({"src/onlyinclude.ts"(){"use strict";init_src(),OnlyincludeToken=class extends Token{get type(){return"onlyinclude"}toString(t){return`<onlyinclude>${super.toString(t)}</onlyinclude>`}isPlain(){return!0}}}}),hiddenToken,init_hidden=__esm({"mixin/hidden.ts"(){"use strict";hiddenToken=(t=!0,e=!0)=>s=>{class i extends s{text(){return""}}return i}}}),NowikiBaseToken,init_base=__esm({"src/nowiki/base.ts"(){"use strict";init_src(),NowikiBaseToken=class extends Token{get innerText(){return this.firstChild.data}constructor(t="",e,s){super(t,e,s)}}}}),_NoincludeToken_decorators,_init3,_a2,NoincludeToken,init_noinclude=__esm({"src/nowiki/noinclude.ts"(){"use strict";init_hidden(),init_base(),_NoincludeToken_decorators=[hiddenToken(!1)],NoincludeToken=class extends(_a2=NowikiBaseToken){get type(){return"noinclude"}toString(t){return t?"":super.toString()}},_init3=__decoratorStart(_a2),NoincludeToken=__decorateElement(_init3,0,"NoincludeToken",_NoincludeToken_decorators,NoincludeToken),__runInitializers(_init3,1,NoincludeToken)}}),TagPairToken,init_tagPair=__esm({"src/tagPair/index.ts"(){"use strict";var t,e;init_src(),TagPairToken=(e=class extends Token{constructor(i,r,n,a,h,u=[]){super(void 0,h);x(this,t);I(this,"closed");I(this,"selfClosing");b(this,t,[i,a||i]),this.closed=a!=="",this.selfClosing=a===void 0,this.append(r,n);const p=typeof r=="string"?-1:u.indexOf(r);u.splice(p===-1?1/0:p,0,this)}toString(i){const{selfClosing:r,firstChild:n,lastChild:a}=this,[h,u]=f(this,t);return r?`<${h}${n.toString(i)}/>`:`<${h}${n.toString(i)}>${a.toString(i)}${this.closed?`</${u}>`:""}`}text(){const[i,r]=f(this,t);return this.selfClosing?`<${i}${this.firstChild.text()}/>`:`<${i}${super.text(">")}${this.closed?`</${r}>`:""}`}},t=new WeakMap,e)}}),_IncludeToken_decorators,_init4,_a3,IncludeToken,init_include=__esm({"src/tagPair/include.ts"(){"use strict";init_hidden(),init_tagPair(),_IncludeToken_decorators=[hiddenToken(!1)],IncludeToken=class extends(_a3=TagPairToken){get type(){return"include"}constructor(t,e="",s,i,r,n){super(t,e,s!=null?s:"",s===void 0||i!=null?i:"",r,n)}toString(t){return t?"":super.toString()}},_init4=__decoratorStart(_a3),IncludeToken=__decorateElement(_init4,0,"IncludeToken",_IncludeToken_decorators,IncludeToken),__runInitializers(_init4,1,IncludeToken)}}),AttributeToken,init_attribute=__esm({"src/attribute.ts"(){"use strict";var t,e,s,i;init_src(),AttributeToken=(i=class extends Token{constructor(n,a,h,u,p,l="",o,c=[]){const d=h;let g;if(a==="gallery"&&h==="caption"||a==="ref"&&h==="details"){const y=z(M({},p),{excludes:[...p.excludes,"heading","html","table","hr","list"]});g=new Token(o,y,c,{}),g.type="attr-value",g.setAttribute("stage",1)}else g=o!=null?o:"";super(void 0,p,c);x(this,t);x(this,e);x(this,s);b(this,t,n),this.append(d,g),b(this,e,l),b(this,s,[...u])}get type(){return f(this,t)}toString(n){const[a="",h=""]=f(this,s);return f(this,e)?super.toString(n,f(this,e)+a)+h:this.firstChild.toString(n)}text(){return f(this,e)?`${super.text(`${f(this,e).trim()}"`)}"`:this.firstChild.text()}},t=new WeakMap,e=new WeakMap,s=new WeakMap,i)}}),toAttributeType,AttributesToken,init_attributes=__esm({"src/attributes.ts"(){"use strict";var t,e;init_string(),init_src(),init_attribute(),toAttributeType=s=>s.slice(0,-1),AttributesToken=(e=class extends Token{constructor(i,r,n,a,h=[]){super(void 0,a,h,{});x(this,t);if(b(this,t,r),i){const u=/([^\s/][^\s/=]*)(?:(\s*=\s*)(?:(["'])([\s\S]*?)(\3|$)|(\S*)))?/gu;let p="",l=u.exec(i),o=0;const c=(()=>{p&&(super.insertAt(p),p="")});for(;l;){const{index:d,0:g,1:y,2:T,3:N,4:_,5:v,6:m}=l;if(p+=i.slice(o,d),/^[\w:][\w:.-]*$/u.test(removeComment(y).trim())){const A=_!=null?_:m,w=[N,v],$=new AttributeToken(toAttributeType(r),n,y,w,a,T,A,h);c(),super.insertAt($)}else p+=g;({lastIndex:o}=u),l=u.exec(i)}p+=i.slice(o),c()}}get type(){return f(this,t)}},t=new WeakMap,e)}}),AtomToken,init_atom=__esm({"src/atom.ts"(){"use strict";var t,e;init_src(),AtomToken=(e=class extends Token{constructor(i,r,n,a,h){super(i,n,a,h);x(this,t);b(this,t,r)}get type(){return f(this,t)}},t=new WeakMap,e)}}),HeadingToken,init_heading=__esm({"src/heading.ts"(){"use strict";var t,e,U,i;init_src(),init_atom(),HeadingToken=(i=class extends Token{constructor(n,a,h,u=[]){super(void 0,h,u);x(this,e);x(this,t);b(this,t,n);const p=new Token(a[0],h,u);p.type="heading-title",p.setAttribute("stage",2);const l=new AtomToken(a[1],"heading-trail",h,u);this.append(p,l)}get type(){return"heading"}get level(){return f(this,t)}toString(n){const a=E(this,e,U).call(this);return a+this.firstChild.toString(n)+a+this.lastChild.toString(n)}text(){const n=E(this,e,U).call(this);return n+this.firstChild.text()+n}},t=new WeakMap,e=new WeakSet,U=function(){return"=".repeat(this.level)},i)}}),ParameterToken,init_parameter=__esm({"src/parameter.ts"(){"use strict";init_string(),init_src(),ParameterToken=class extends Token{get type(){return"parameter"}get anon(){return this.firstChild.length===0}constructor(t,e,s,i=[]){super(void 0,s,i);const r=new Token(typeof t=="number"?void 0:t,s,i,{}),n=new Token(e,s,i);r.type="parameter-key",r.setAttribute("stage",2),n.type="parameter-value",n.setAttribute("stage",2),this.append(r,n)}trimName(t,e=!0){const s=t.toString(!0).replace(/^[ \t\n\0\v]+|([^ \t\n\0\v])[ \t\n\0\v]+$/gu,"$1");return this.setAttribute("name",s),s}afterBuild(){if(!this.anon){const{parentNode:t,firstChild:e}=this,s=this.trimName(e);t&&t.getArgs(s,!1,!1).add(this)}super.afterBuild()}toString(t){return this.anon?this.lastChild.toString(t):super.toString(t,"=")}text(){return this.anon?this.lastChild.text():super.text("=")}getValue(){var e;const t=removeComment(this.lastChild.text());return this.anon&&((e=this.parentNode)==null?void 0:e.isTemplate())!==!1?t:t.trim()}setValue(t){this.lastChild.replaceChildren(t)}}}}),format,TranscludeToken,init_transclude=__esm({"src/transclude.ts"(){"use strict";var t,e,s,i,r,n,Y,Z,u;init_string(),init_debug(),init_src(),init_parameter(),init_atom(),format=p=>{const{lastChild:l,type:o}=p,c=l.type==="parameter";!(o==="template"?c&&l.anon:l.type==="magic-word-name")&&!l.toString().endsWith(`
`)&&(c?l.lastChild:l).insertAt(`
`)},TranscludeToken=(u=class extends Token{constructor(l,o,c,d=[]){var j,L;let g;const y=/^(?:\s|\0\d+[cn]\x7F)*\0(\d+)h\x7F(?:\s|\0\d+[cn]\x7F)*/u.exec(l);y&&(g=Number(y[1]),l=l.replace(`\0${g}h`,d[g].toString().replace(/^\n/u,"")));super(void 0,c,d,{});x(this,n);I(this,"modifier","");x(this,t,"template");x(this,e,":");x(this,s,!1);x(this,i,new Map);x(this,r);const{parserFunction:T,variable:N,functionHook:_}=c,v=(j=/^(?:\s|\0\d+[cn]\x7F)*\0\d+s\x7F/u.exec(l))==null?void 0:j[0];if(v)this.setAttribute("modifier",v),l=l.slice(v.length);else if(l.includes(":")){const[O,...S]=l.split(":"),[C]=/^(?:\s|\0\d+[cn]\x7F)*/u.exec((L=S[0])!=null?L:"");this.setModifier(`${O}:${C}`)&&(l=S.join(":").slice(C.length))}const m=l.search(/[:：]/u),A=l[m]==="：",w=m!==-1;if(w||o.length===0&&!f(this,s)){const O=w?l.slice(0,m):l,S=w&&l.slice(m+1),C=removeComment(O),P=w?C.slice(C.search(/\S/u))+(A?"：":""):C.trim(),[,F,q]=getMagicWordInfo(P,T),W=!("functionHook"in c)||_.includes(q),B=N.includes(q);if(w?q&&W:B){this.setAttribute("name",q),b(this,t,"magic-word"),A&&b(this,e,"：");const R=new AtomToken(O,"magic-word-name",c,d);super.insertAt(R),S!==!1&&o.unshift([S])}}if(this.type==="template"){const O=removeComment(l).trim();if(!this.normalizeTitle(O,10,{halfParsed:!0,temporary:!0}).valid)throw d.pop(),new SyntaxError("Invalid template name");const S=new AtomToken(l,"template-name",c,d,{});super.insertAt(S)}typeof g=="number"&&(d[g]=void 0);const $=this.isTemplate();let k=1;for(let O=0;O<o.length;O++){const S=o[O];$||(S[0]=S.join("="),S.length=1),S.length===1&&(S.unshift(k),k++),this.insertAt(new ParameterToken(...S,c,d))}}get type(){return f(this,t)}setModifier(l){const{parserFunction:[,,o,c]}=this.getAttribute("config"),g=removeComment(l).trim().slice(0,-1).toLowerCase(),y=o.includes(g),T=c.includes(g);return y||T||!l?(this.setAttribute("modifier",l),b(this,s,y),!!l):!1}isTemplate(){return this.type==="template"}afterBuild(){this.modifier.includes("\0")&&this.setAttribute("modifier",this.buildFromStr(this.modifier,0)),super.afterBuild(),this.isTemplate()&&(b(this,r,E(this,n,Y).call(this)),this.setAttribute("name",f(this,r).title))}toString(l){const{childNodes:o,length:c,firstChild:d,modifier:g,type:y,name:T}=this;return`{{${g}${y==="magic-word"?d.toString(l)+(c===1?"":f(this,e))+o.slice(1).map(N=>N.toString(l)).join("|"):super.toString(l,"|")}}}`}text(){const{childNodes:l,length:o,firstChild:c,modifier:d,type:g}=this;return`{{${d}${g==="magic-word"?c.text()+(o===1?"":f(this,e))+text(l.slice(1),"|"):super.text("|")}}}`}insertAt(l,o=this.length){return super.insertAt(l,o),l.anon?E(this,n,Z).call(this,l):l.name&&this.getArgs(l.name,!1,!1).add(l),l}getAllArgs(){return this.childNodes.slice(1)}getAnonArgs(){return this.getAllArgs().filter(({anon:l})=>l)}getArgs(l,o,c=!0){const d=String(l).replace(/^[ \t\n\0\v]+|([^ \t\n\0\v])[ \t\n\0\v]+$/gu,"$1");let g;return f(this,i).has(d)?g=f(this,i).get(d):(g=new Set(this.getAllArgs().filter(({name:y})=>d===y)),f(this,i).set(d,g)),g}getArg(l){const{childNodes:o}=this;return[...this.getArgs(l)].sort((c,d)=>o.indexOf(d)-o.indexOf(c))[0]}getValue(l){var o;return(o=this.getArg(l))==null?void 0:o.getValue()}setValue(l,o,c){const d=this.getArg(l);if(d){d.setValue(o);return}c&&format(this),this.insertAt(new ParameterToken(String(l),o,this.getAttribute("config")))}},t=new WeakMap,e=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakMap,n=new WeakSet,Y=function(){const l=this.type==="template";return this.normalizeTitle(this.childNodes[0].text(),10,M({temporary:!0},!l&&{page:""}))},Z=function(l){const o=this.getAnonArgs(),c=!0,d=l,g=String(o.length);d.setAttribute("name",g),this.getArgs(g,!1,!1).add(d)},u)}}),_HiddenToken_decorators,_init5,_a4,HiddenToken,init_hidden2=__esm({"src/hidden.ts"(){"use strict";init_hidden(),init_src(),_HiddenToken_decorators=[hiddenToken()],HiddenToken=class extends(_a4=Token){get type(){return"hidden"}},_init5=__decoratorStart(_a4),HiddenToken=__decorateElement(_init5,0,"HiddenToken",_HiddenToken_decorators,HiddenToken),__runInitializers(_init5,1,HiddenToken)}}),ArgToken,init_arg=__esm({"src/arg.ts"(){"use strict";init_string(),init_src(),init_atom(),init_hidden2(),ArgToken=class extends Token{get type(){return"arg"}constructor(t,e,s=[]){super(void 0,e,s,{});for(let i=0;i<t.length;i++){const r=t[i];if(i===0){const n=new AtomToken(r,"arg-name",e,s,{});super.insertAt(n)}else if(i>1){const n=new HiddenToken(r,e,s);super.insertAt(n)}else{const n=new Token(r,e,s);n.type="arg-default",n.setAttribute("stage",2),super.insertAt(n)}}}toString(t){return`{{{${super.toString(t,"|")}}}}`}text(){return`{{{${text(this.childNodes.slice(0,2),"|")}}}}`}}}}),braces_exports={};__export(braces_exports,{parseBraces:()=>parseBraces});var closes,lbrack,newline,openBraces,marks,getExecRegex,reReplace,getSymbol,parseBraces,init_braces=__esm({"parser/braces.ts"(){"use strict";init_dist(),init_string(),init_heading(),init_transclude(),init_arg(),closes={"=":String.raw`\n(?!(?:[^\S\n]|\0\d+[cn]\x7F)*\n)`,"{":String.raw`\}{2,}|\|`,"-":String.raw`\}-`,"[":String.raw`\]\]`},lbrack=String.raw`\[(?!\[)`,newline=String.raw`\n(?![=\0])`,openBraces=String.raw`|\{{2,}`,marks=new Map([["!","!"],["!!","+"],["(!","{"],["!)","}"],["!-","-"],["=","~"],["server","m"]]),getExecRegex=getRegex(t=>new RegExp(t,"gmu")),reReplace=new RegExp(String.raw`\{\{((?:[^\n{}[]|${lbrack}|${newline})*)\}\}(?!\})`+"|"+String.raw`\[\[(?:[^\n[\]{]|${newline})*\]\]`+"|"+String.raw`-\{(?:[^\n{}[]|${lbrack}|${newline})*\}-`,"gu"),getSymbol=t=>{const e=trimLc(removeComment(t));return marks.has(e)?marks.get(e):/^(?:filepath|(?:full|canonical)urle?):./u.test(e)?"m":"t"},parseBraces=(t,e,s)=>{var g,y,T,N,_;const i=String.raw`${e.excludes.includes("heading")?"":String.raw`^((?:\0\d+[cno]\x7F)*)={1,6}|`}\[\[|-\{(?!\{)`,{parserFunction:[,,,r]}=e,n=[],a=[],h=(v,m,A,w)=>{m[m.length-1].push(restore(v.slice(A,w),a))};let u;do u!==void 0&&(t=u),u=t.replace(reReplace,(v,m,A)=>{if(m!==void 0||typeof A=="string")try{const{length:w}=s,$=(m!=null?m:A).split("|");return new TranscludeToken(restore($[0],a),$.slice(1).map(k=>{const j=k.indexOf("=");return(j===-1?[k]:[k.slice(0,j),k.slice(j+1)]).map(L=>restore(L,a))}),e,s),`\0${w}${getSymbol($[0])}`}catch(w){if(!(w instanceof SyntaxError)||w.message!=="Invalid template name")throw w}return a.push(restore(v,a)),`\0${a.length-1}`});while(u!==t);t=u;const p=t.lastIndexOf("}}")-t.length;let l=p+t.length!==-1,o=getExecRegex(i+(l?openBraces:"")),c=o.exec(t),d;for(;c||d!==void 0&&d<=t.length&&((y=(g=n[n.length-1])==null?void 0:g[0])!=null&&y.startsWith("="));){if(c!=null&&c[1]){const[,{length:C}]=c;c[0]=c[0].slice(C),c.index+=C}const{0:v,index:m}=c!=null?c:{0:`
`,index:t.length},A=(T=n.pop())!=null?T:{},{0:w,index:$,parts:k,findEqual:j,pos:L}=A,O=v==="="&&j;if(v==="]]"||v==="}-")d=m+2;else if(v===`
`){d=m+1;const{pos:C,findEqual:P}=(N=n[n.length-1])!=null?N:{};if(C===void 0||P||removeComment(t.slice(C,$))!==""){const F=/^(={1,6})(.+)\1((?:\s|\0\d+[cn]\x7F)*)$/u.exec(t.slice($,m));F&&(F[2]=restore(F[2],a),F[2].includes(`
`)||(t=`${t.slice(0,$)}\0${s.length}h${t.slice(m)}`,d=$+4+String(s.length).length,new HeadingToken(F[1].length,F.slice(2),e,s)))}}else if(v==="|"||O)d=m+1,h(t,k,L,m),v==="|"&&k.push([]),A.pos=d,A.findEqual=v==="|",n.push(A);else if(v.startsWith("}}")){const C=v.slice(0,Math.min(w.length,3)),P=w.length-C.length,{length:F}=s;d=m+C.length,h(t,k,L,m);let q=!1,W="t";if(C.length===3){const B=k.map(rt=>rt.join("=")),R=B.length>1&&removeComment(B[1]).trim();new ArgToken(B,e,s),R&&R.endsWith(":")&&r.includes(R.slice(0,-1).toLowerCase())&&(W="s")}else try{new TranscludeToken(k[0][0],k.slice(1),e,s),W=getSymbol(k[0][0])}catch(B){if(B instanceof SyntaxError&&B.message==="Invalid template name")q=!0;else throw B}q||(t=`${t.slice(0,$+P)}\0${F}${W}${t.slice(d)}`,d=$+P+3+String(F).length,P>1?n.push({0:w.slice(0,P),index:$,pos:$+P,parts:[[]]}):P===1&&t[$-1]==="-"&&n.push({0:"-{",index:$-1,pos:$+1,parts:[[]]}))}else d=m+v.length,v.startsWith("{")&&(c.pos=d,c.parts=[[]]),n.push(..."0"in A?[A]:[],c);let S=n[n.length-1];if(l&&p+t.length<d)for(l=!1;(_=S==null?void 0:S[0])!=null&&_.startsWith("{");)n.pop(),S=n[n.length-1];o=getExecRegex(i+(l?openBraces:"")+(S?`|${closes[S[0][0]]}${S.findEqual?"|=":""}`:"")),o.lastIndex=d,c=o.exec(t)}return restore(t,a)}}}),nested_exports={};__export(nested_exports,{NestedToken:()=>NestedToken});var NestedToken,init_nested=__esm({"src/nested.ts"(){"use strict";init_commentAndExt(),init_braces(),init_src(),NestedToken=class extends Token{get type(){return"ext-inner"}constructor(t,e,s,i,r=[]){const n=Symbol("NestedToken"),{length:a}=r;r.push(n),t&&(t=parseCommentAndExt(t,i,r,e)),t&&(t=parseBraces(t,i,r)),r.splice(a,1),super(t,i,r)}}}}),MultiLineToken,init_multiLine=__esm({"src/multiLine/index.ts"(){"use strict";init_src(),MultiLineToken=class extends Token{get type(){return"ext-inner"}toString(t){return super.toString(t,`
`)}text(){return super.text(`
`).replace(/\n\s*\n/gu,`
`)}}}}),LinkBaseToken,init_base2=__esm({"src/link/base.ts"(){"use strict";var t,e;init_src(),LinkBaseToken=(e=class extends Token{constructor(i,r,n,a=[],h="|"){super(void 0,n,a,{});x(this,t);this.insertAt(i),b(this,t,h)}toString(i){return super.toString(i,f(this,t))}text(){return super.text("|")}},t=new WeakMap,e)}}),ImageParameterToken,init_imageParameter=__esm({"src/imageParameter.ts"(){"use strict";init_src(),ImageParameterToken=class extends Token{get type(){return"image-parameter"}}}}),FileToken,init_file=__esm({"src/link/file.ts"(){"use strict";init_base2(),init_imageParameter(),FileToken=class extends LinkBaseToken{constructor(t,e,s,i=[],r="|",n){super(t,void 0,s,i,r),e!==void 0&&this.append(new ImageParameterToken(e,s,i))}}}}),GalleryImageToken,init_galleryImage=__esm({"src/link/galleryImage.ts"(){"use strict";init_constants(),init_src(),init_file(),GalleryImageToken=class extends FileToken{constructor(e,s,i,r,n=[]){let a;if(i!==void 0){const{length:u}=n;a=new Token(i,r,n);for(let p=0;p<MAX_STAGE;p++)a.parseOnce();n.splice(u,1)}const h=`${e}-image`;super(s,a==null?void 0:a.firstChild.toString(),r,n,void 0,h);I(this,"privateType","imagemap-image");this.privateType=h}get type(){return this.privateType}}}}),gallery_exports={};__export(gallery_exports,{GalleryToken:()=>GalleryToken});var GalleryToken,init_gallery=__esm({"src/multiLine/gallery.ts"(){"use strict";var t,tt,s;init_multiLine(),init_galleryImage(),GalleryToken=(s=class extends MultiLineToken{constructor(r,n,a=[]){var h;super(void 0,n,a,{});x(this,t);for(const u of(h=r==null?void 0:r.split(`
`))!=null?h:[]){const p=/^([^|]+)(?:\|(.*))?/u.exec(u);if(!p){super.insertAt(u);continue}const[,l,o]=p;E(this,t,tt).call(this,l)?super.insertAt(new GalleryImageToken("gallery",l,o,n,a)):super.insertAt(u)}}},t=new WeakSet,tt=function(r){return this.normalizeTitle(r,6,{halfParsed:!0,temporary:!0,decode:!0,page:""}).valid},s)}}),nowiki_exports={};__export(nowiki_exports,{NowikiToken:()=>NowikiToken});var NowikiToken,init_nowiki=__esm({"src/nowiki/index.ts"(){"use strict";init_base(),NowikiToken=class extends NowikiBaseToken{get type(){return"ext-inner"}}}}),ExtToken,init_ext=__esm({"src/tagPair/ext.ts"(){"use strict";init_index(),init_src(),init_tagPair(),init_attributes(),ExtToken=class extends TagPairToken{get type(){return"ext"}constructor(t,e,s,i,r=index_default.getConfig(),n=!1,a=[]){const h=t.toLowerCase(),u=new AttributesToken(!e||/^\s/u.test(e)?e:` ${e}`,"ext-attrs",h,r,a),p=z(M({},r),{ext:r.ext.filter(o=>o!==h),excludes:[...r.excludes]});let l;switch(h){case"indicator":case"poem":case"ref":h==="poem"&&p.excludes.push("heading"),l=new Token(s,p,a);break;case"references":{const{NestedToken:o}=(init_nested(),__toCommonJS(nested_exports));p.excludes.push("heading"),l=new o(s,n,["ref"],p,a);break}case"gallery":{const{GalleryToken:o}=(init_gallery(),__toCommonJS(gallery_exports));l=new o(s,p,a);break}default:{const{NowikiToken:o}=(init_nowiki(),__toCommonJS(nowiki_exports));l=new o(s,p,a)}}l.setAttribute("name",h),l.type==="plain"&&(l.type="ext-inner"),super(t,u,l,i,r,a)}}}}),_CommentToken_decorators,_init6,_a5,CommentToken,init_comment=__esm({"src/nowiki/comment.ts"(){"use strict";init_hidden(),init_base(),_CommentToken_decorators=[hiddenToken(!1)],CommentToken=class extends(_a5=NowikiBaseToken){constructor(e,s,i,r){super(e,i,r);I(this,"closed");this.closed=s}get type(){return"comment"}toString(e){return e?"":`<!--${this.innerText}${this.closed?"-->":""}`}},_init6=__decoratorStart(_a5),CommentToken=__decorateElement(_init6,0,"CommentToken",_CommentToken_decorators,CommentToken),__runInitializers(_init6,1,CommentToken)}}),commentAndExt_exports={};__export(commentAndExt_exports,{parseCommentAndExt:()=>parseCommentAndExt});var onlyincludeLeft,onlyincludeRight,length,getExtRegex,update,parseCommentAndExt,init_commentAndExt=__esm({"parser/commentAndExt.ts"(){"use strict";init_dist(),init_onlyinclude(),init_noinclude(),init_include(),init_ext(),init_comment(),onlyincludeLeft="<onlyinclude>",onlyincludeRight="</onlyinclude>",{length}=onlyincludeLeft,getExtRegex=[!1,!0].map(t=>{const e=t?"includeonly":"(?:no|only)include",s=t?"noinclude":"includeonly";return getRegex(i=>new RegExp(String.raw`<!--[\s\S]*?(?:-->|$)|<${e}(?:\s[^>]*)?/?>|</${e}\s*>|<(${i})(\s[^>]*?)?(?:/>|>([\s\S]*?)</(${"\\1"}\s*)>)|<(${s})(\s[^>]*?)?(?:/>|>([\s\S]*?)(?:</(${s}\s*)>|$))`,"giu"))}),update=t=>{const e=t.indexOf(onlyincludeLeft);return{i:e,j:t.indexOf(onlyincludeRight,e+length)}},parseCommentAndExt=(t,e,s,i)=>{if(i){let{i:u,j:p}=update(t);if(u!==-1&&p!==-1){let l="";const o=c=>{new NoincludeToken(c,e,s),l+=`\0${s.length-1}n`};for(;u!==-1&&p!==-1;){const c=`\0${s.length}g`;new OnlyincludeToken(t.slice(u+length,p),e,s),u>0&&o(t.slice(0,u)),l+=c,t=t.slice(p+length+1),{i:u,j:p}=update(t)}return t&&o(t),l}}const{ext:r}=e;let n=r,a=e;r.includes("translate")&&(n=r.filter(u=>u!=="translate"&&u!=="tvar"),a=z(M({},e),{ext:n}));const h=getExtRegex[i?1:0](n.join("|"));return h.lastIndex=0,h.test(t)?t.replace(h,(u,p,l,o,c,d,g,y,T)=>{const N=s.length;let _="n";if(p)_="e",new ExtToken(p,l,o,c,a,d,s);else if(u.startsWith("<!--")){_="c";const v=u.endsWith("-->");new CommentToken(u.slice(4,v?-3:void 0),v,e,s)}else d?new IncludeToken(d,g,y,T,e,s):new NoincludeToken(u,e,s,!0);return`\0${N}${_}`}):t}}}),src_exports={};__export(src_exports,{Token:()=>Token});var Token,init_src=__esm({"src/index.ts"(){"use strict";var t,e,s,i,r,n,et,st,u;init_string(),init_constants(),init_debug(),init_index(),init_element(),init_text(),Token=(u=class extends AstElement{constructor(o,c=index_default.getConfig(),d=[],g){super();x(this,n);x(this,t,"plain");x(this,e,0);x(this,s);x(this,i);x(this,r);typeof o=="string"&&this.insertAt(o),b(this,s,c),b(this,i,d),d.push(this)}get type(){return f(this,t)}set type(o){b(this,t,o)}parseOnce(o=f(this,e),c=!1,d){if(o<f(this,e)||this.length!==1||!this.isPlain())return this;if(f(this,e)>=MAX_STAGE)return this;switch(o){case 0:this.type==="root"&&f(this,i).pop(),b(this,r,c),E(this,n,et).call(this,c);break;case 1:E(this,n,st).call(this)}if(this.type==="root")for(const g of f(this,i))g==null||g.parseOnce(o,c,d);return Q(this,e)._++,this}buildFromStr(o,c){const d=o.split(/[\0\x7F]/u).map((g,y)=>{if(y%2===0)return g&&new AstText(g);const T=Number(g.slice(0,-1));if(isNaN(g.slice(-1))&&Number.isInteger(T)&&T>=0&&T<f(this,i).length)return f(this,i)[T];throw new Error(`Failed to build! Unrecognized token: ${g}`)}).filter(g=>g!=="");return c===0?d.map(String).join(""):c===1?text(d):d}build(){b(this,e,MAX_STAGE);const{length:o,firstChild:c}=this,d=c==null?void 0:c.toString();if(o===1&&c.type==="text"&&d.includes("\0")&&(setChildNodes(this,0,1,this.buildFromStr(d)),this.type==="root"))for(const g of f(this,i))g==null||g.build()}afterBuild(){if(this.type==="root")for(const o of f(this,i))o==null||o.afterBuild()}parse(o=MAX_STAGE,c,d){for(o=Math.min(o,MAX_STAGE);f(this,e)<o;)this.parseOnce(f(this,e),c,d);return o&&(this.build(),this.afterBuild()),this}isPlain(){return this.constructor===u}getAttribute(o){switch(o){case"config":return f(this,s);default:return super.getAttribute(o)}}setAttribute(o,c){switch(o){case"stage":f(this,e)===0&&this.type==="root"&&f(this,i).shift(),b(this,e,c);break;default:super.setAttribute(o,c)}}insertAt(o,c=this.length){const d=typeof o=="string"?new AstText(o):o,{length:g}=this;c+=c<0?g:0,super.insertAt(d,c);const{type:y}=d;return y==="root"&&(d.type="plain"),d}normalizeTitle(o,c=0,d){return index_default.normalizeTitle(o,c,f(this,r),f(this,s),d)}},t=new WeakMap,e=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakMap,n=new WeakSet,et=function(o){const{parseCommentAndExt:c}=(init_commentAndExt(),__toCommonJS(commentAndExt_exports));this.setText(c(this.firstChild.toString(),f(this,s),f(this,i),o))},st=function(){const{parseBraces:o}=(init_braces(),__toCommonJS(braces_exports)),c=this.type==="root"?this.firstChild.toString():`\0${this.firstChild.toString()}`,d=o(c,f(this,s),f(this,i));this.setText(this.type==="root"?d:d.slice(1))},u)}}),index_exports={};__export(index_exports,{default:()=>index_default}),module.exports=__toCommonJS(index_exports);var Parser,index_default,init_index=__esm({"index.ts"(){init_debug(),init_constants(),init_string(),init_title(),Parser={getConfig(t){const e=t!=null?t:this.config,{}=e;return z(M(M({},minConfig),e),{excludes:[]})},normalizeTitle(t,e=0,s,i=Parser.getConfig(),r){let n;if(r!=null&&r.halfParsed)n=new Title(t,e,i,r);else{const{Token:a}=(init_src(),__toCommonJS(src_exports));n=Shadow.run(()=>{const h=new a(t,i);h.type="root",h.parseOnce(0,s).parseOnce();const u=new Title(h.firstChild.toString(),e,i,r);h.build();for(const p of["main"]){const l=u[p];if(l!=null&&l.includes("\0")){const o=h.buildFromStr(l,1);u.main=o}}return u},this)}return n},parse(t,e,s,i,r){t=tidy(t);let n,a,h,u;typeof e=="string"?(n=!!s,a=i,h=r):(n=!!e,a=s,h=i),a!=null||(a=MAX_STAGE),h!=null||(h=this.getConfig());const{Token:p}=(init_src(),__toCommonJS(src_exports));return Shadow.run(()=>{const o=new p(t,h);return o.type="root",o.parse(a,n)})}},index_default=Parser}});init_index();
//# sourceMappingURL=bundle.min.js.map
