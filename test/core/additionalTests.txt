!! test
Multiple <onlyinclude> being included
!! wikitext
{{Includes4}}
!! html
<p>FooBaz
</p>
!! end

!! test
#vardefine at SOL
!! wikitext
{{#vardefine:test|heading}}==Heading==
{{#vardefine:test|hr}}----
{{#vardefine:test|list}};dt:dd
{{#vardefine:test|table}}{|
|-
! !!
|}
!! end

!! test
Case-sensitive behavior switches in lower cases
!! wikitext
__index__
!! end

!! test
Category / whitespace (newline and non-newline) interactions
!! wikitext
x
[[Category:A]] [[Category:B]]
y
!! html
<p>x
y
</p>
!! end

!! test
Nested file links
!! wikitext
[[file:thumb.jpg|[[file:thumb.png|Thumb|thumb]]|thumb]]
[[file:thumb.jpg|[[file:thumb.png|[[T]]humb|thumb]]|thumb]]
!! end

!! test
&lt; in an external link
!! wikitext
[https://mediawiki.org/&LT;&lt;text]
[https://mediawiki.org/&GT;&gt;text]
!! end

!! test
Magic links in lower cases
!! wikitext
pmid 1 PMID 1
rfc 1 RFC 1
isbn 1234567890 ISBN 1234567890
!! end

!! test
Font of text following an external link
!! wikitext
[//a ''b]c
!! html
<p><a rel="nofollow" class="external text" href="//a"><i>b</i></a><i>c</i>
</p>
!! end

!! test
Interaction between apostrophes and <b> tags
!! wikitext
'''a</b>b<b>c'''d
!! html
<p><b>a</b>b<b>c</b>d
</p>
!! end

!! test
Function hook and variable
!! wikitext
{{uc}}{{server:}}
!! html
<p><a href="/index.php?title=Template:Uc&amp;action=edit&amp;redlink=1" class="new" title="Template:Uc (page does not exist)">Template:Uc</a><a href="/index.php?title=Template:Server:&amp;action=edit&amp;redlink=1" class="new" title="Template:Server: (page does not exist)">Template:Server:</a>
</p>
!! end

!! test
New tvar syntax
!! wikitext
<translate><tvar name="name">contents</tvar></translate>
!! html
<p>contents
</p>
!! end

!! test
Unicode number before autolinks
!! wikitext
１http://example.com
!! html
<p>１http://example.com
</p>
!! end

!! test
Common prefix ';'
!! wikitext
;;;t3:::d3
;;;;;t5::::::d5

;t1
;*t1:d1
;*t1:d1
!! html
<dl><dt>t3</dt>
<dd><dl><dt></dt>
<dd><dl><dt></dt>
<dd>d3</dd></dl></dd></dl></dd></dl>
<dl><dt>t5</dt>
<dd><dl><dt></dt>
<dd><dl><dt></dt>
<dd><dl><dt></dt>
<dd><dl><dt></dt>
<dd>:d5</dd></dl></dd></dl></dd></dl></dd></dl></dd></dl>
<dl><dt>t1</dt></dl>
<dl><dt>t1</dt>
<dd><ul><li>d1</li>
<li>t1:d1</li></ul></dd></dl>
!! end

!! test
Extension tag in language conversion
!! wikitext
-{<pre>foo</pre>}-

-{<pre>foo</pre>|bar}-
!! html
<pre>foo</pre><p>
bar</p>
!! end

!! test
Template in language conversion
!! wikitext
-{{{1x|foo}} }-

-{{{1x|foo}}|bar}-
!! html
<p>foo 
</p><p>bar
</p>
!! end

!! test
Template variable in language conversion
!! wikitext
-{{{{foo}}} }-

-{{{{foo}}}|bar}-

-{{{{foo|baz}}} }-

-{{{{foo|baz}}}|bar}-
!! html
<p>{{{foo}}} 
</p><p>bar
</p><p>baz 
</p><p>bar
</p>
!! end

!! test
Section heading in language conversion
!! wikitext
-{
==foo==
}-

-{
==foo==
|bar}-
!! html
<p class="mw-empty-elt">
</p>
<div class="mw-heading mw-heading2"><h2 id="foo">foo</h2></div>
<p class="mw-empty-elt">
</p><p>bar
</p>
!! end

!! test
HTML tag in language conversion
!! wikitext
-{<b>foo</b>}-

-{<b>foo</b>|bar}-
!! html
<p><b>foo</b>
</p><p>bar
</p>
!! end

!! test
Table in language conversion
!! wikitext
-{
{|
|foo
|}}-

-{
{|
|foo
|}|bar}-
!! html
<p class="mw-empty-elt">
</p>
<table>
<tbody><tr>
<td>foo
</td></tr></tbody></table>
<p>bar</p>
!! end

!! test
Hr in language conversion
!! wikitext
-{
----}-

-{
----|bar}-
!! html
<p class="mw-empty-elt">
</p>
<hr />
<p>bar</p>
!! end

!! test
Internal link in language conversion
!! wikitext
-{[[foo]]}-

-{[[foo]]|bar}-
!! html
<p><a href="/wiki/Foo" title="Foo">foo</a>
</p><p>bar
</p>
!! end

!! test
Quote in language conversion
!! wikitext
-{''foo''}-

-{''foo''|bar}-
!! html
<p><i>foo</i>
</p><p>bar
</p>
!! end

!! test
External link in language conversion
!! wikitext
-{[//foo]}-

-{[//foo]|bar}-
!! html
<p><a rel="nofollow" class="external autonumber" href="https://foo">[1]</a>
</p><p>bar
</p>
!! end

!! test
List in language conversion
!! wikitext
-{
*foo}-

-{
*foo|bar}-
!! html
<p class="mw-empty-elt">
</p>
<ul><li>foo</li></ul>
<p>bar</p>
!! end

!! test
Magic link in language conversion
!! wikitext
-{PMID 1}-

-{PMID 1|bar}-
!! html
<p><a class="external mw-magiclink-pmid" rel="nofollow" href="//www.ncbi.nlm.nih.gov/pubmed/1?dopt=Abstract">PMID 1</a>
</p><p>bar
</p>
!! end

!! test
Nested <poem><pre>
!! wikitext
<poem><pre>
this
is
a
test
</pre></poem>
!! html
<div class="poem">
<pre><br />
this<br />
is<br />
a<br />
test<br />
</pre>
</div>
!! end

!! test
Precedence of table over links
!! wikitext
{|
! [[Foo!!]]
| [[Bar
|Baz]]
|}
!! html
<table>
<tbody><tr>
<th>[[Foo</th>
<th>]]
</th>
<td>[[Bar
</td>
<td>Baz]]
</td></tr></tbody></table>
!! end

!! test
Upper-case language variant is acceptable in conversion rules
!! wikitext
-{zh-Hans:a;zh-Hant:b}-
!! html
<p>a
</p>
!! end

!! test
Do not translate external URL
!! wikitext
<translate>[<tvar name=1>http://example.net</tvar> text]</translate>

[<!-- -->//example.net text]
!! html
<p><a rel="nofollow" class="external text" href="http://example.net">text</a>
</p><p><a rel="nofollow" class="external text" href="//example.net">text</a>
</p>
!! end

!! test
Commented <translate> tags
!! wikitext
<!-- <translate><tvar name=1></tvar></translate> --><includeonly><translate><tvar name=2></tvar></translate></includeonly>
!! html
!! end

!! test
Subpage in #ifexist
!! options
title=[[Root]]
!! wikitext
{{#ifexist:/ifexist|yes|no}}
!! html
<p>no
</p>
!! end

!! test
Parent directory in #ifexist
!! options
title=[[Root/ifexist]]
!! wikitext
{{#ifexist:../ifexist|yes|no}}
!! html
<p>no
</p>
!! end

!! test
Subpage in redirect
!! options
title=[[Root]]
!! wikitext
#redirect [[/redirect]]
!! html
<ul class="redirectText"><li><a href="/w/index.php?title=/redirect&amp;action=edit&amp;redlink=1" class="new" title="/redirect (page does not exist)">/redirect</a></li></ul></div>
!! end

!! test
Parent directory in redirect
!! options
title=[[Root/redirect]]
!! wikitext
#redirect [[../test]]
!! html
<ol><li>redirect <a href="/w/index.php?title=Root/test&amp;action=edit&amp;redlink=1" class="new" title="Root/test (page does not exist)">Root/test</a></li></ol>
!! end

!! test
Subpage in image link
!! options
title=[[Root]]
!! wikitext
[[File:Foobar.jpg|link=/image]]
!! html
<p><span class="mw-default-size" typeof="mw:File"><a href="/wiki//image" title="/image"><img src="//upload.wikimedia.org/wikipedia/commons/3/3a/Foobar.jpg" decoding="async" width="240" height="28" class="mw-file-element" data-file-width="240" data-file-height="28"></a></span>
</p>
!! end

!! test
Parent directory in image link
!! options
title=[[Root/image]]
!! wikitext
[[File:Foobar.jpg|link=../test]]
!! html
<p><span class="mw-default-size" typeof="mw:File"><a href="/wiki/File:Foobar.jpg" class="mw-file-description" title="link=../test"><img alt="link=../test" src="//upload.wikimedia.org/wikipedia/commons/3/3a/Foobar.jpg" decoding="async" width="240" height="28" class="mw-file-element" data-file-width="240" data-file-height="28"></a></span>
</p>
!! end

!! test
Japanese behavior switches
!! wikitext
＿＿目次非表示＿＿
!! html
!! end

!! test
Basic {{nse:}} test
!! wikitext
{{nse:1}}

{{nse:01}}

{{nse:0}}

{{nse:00}}

{{nse:-1}}

{{nse:User}}

{{nse:User_talk}}

{{nse:uSeR tAlK}}

{{nse:File}}

{{nse:Image}}
!! html
<p>Talk
</p><p>Talk
</p><p><br />
</p><p><br />
</p><p>Special
</p><p>User
</p><p>User_talk
</p><p>User_talk
</p><p>File
</p><p>File
</p>
!! end

!! test
Basic {{localurle:}} test
!! wikitext
{{localurle: media:top%20level#fragment }}

{{localurle: file:top%20level#fragment | action=edit&preload=

" }}
!! html
<p>/wiki/File:Top_level
</p><p>/index.php?title=File:Top_level&amp;action=edit&amp;preload=
</p><p>&quot;
</p>
!! end

!! test
Basic {{fullurl:}} test
!! wikitext
{{fullurl: media:top%20level#fragment }}

{{fullurle: file:top%20level#fragment | action=edit&preload=

" }}
!! html
<p>//example.org/wiki/File:Top_level
</p><p>//example.org/index.php?title=File:Top_level&amp;action=edit&amp;preload=__&quot;#fragment
</p>
!! end

!! test
Basic {{canonicalurl:}} test
!! wikitext
{{canonicalurl: media:top%20level#fragment }}

{{canonicalurle: file:top%20level#fragment | action=edit&preload=

" }}
!! html
<p><a rel="nofollow" class="external free" href="https://example.org/wiki/File:Top_level">https://example.org/wiki/File:Top_level</a>
</p><p><a rel="nofollow" class="external free" href="https://example.org/index.php?title=File:Top_level&amp;action=edit&amp;preload=__&quot;#fragment">https://example.org/index.php?title=File:Top_level&amp;action=edit&amp;preload=__&quot;#fragment</a>
</p>
!! end

!! test
Basic {{GENDER:}} test
!! wikitext
{{GENDER:username|gender-neutral text applicable to all genders}}

{{GENDER:username|text if user is male|text if user is female|text for unspecified gender}}

{{GENDER:|text if user is male|text if user is female|text for unspecified gender}}

{{GENDER:.|text if user is male|text if user is female|text for unspecified gender}}
!! html
<p>gender-neutral text applicable to all genders
</p><p>text for unspecified gender
</p><p>text for unspecified gender
</p><p>text for unspecified gender
</p>
!! end

!! test
Basic {{NAMESPACE}} test
!! wikitext
{{NAMESPACE:Template talk:Main Page}}

{{NAMESPACEE:Template talk:Main Page}}

{{NAMESPACENUMBER:Template talk:Main Page}}

{{TALKSPACE:Template:Main Page}}

{{TALKSPACEE:Template:Main Page}}

{{SUBJECTSPACE:Template talk:Main Page}}

{{SUBJECTSPACEE:Template talk:Main Page}}
!! html
<p>Template talk
</p><p>Template_talk
</p><p>11
</p><p>Template talk
</p><p>Template_talk
</p><p>Template
</p><p>Template
</p>
!! end

!! test
Basic {{DIRMARK}} test
!! wikitext
{{DIRMARK}}
!! html
<p>‎
</p>
!! end

!! test
T401099
!! wikitext
{{#tag:pre|CLICK|data-/onclick=alert("CLICKED")}}
!! html
<pre data-="">CLICK</pre>
!! end

!! test
Basic {{#iferror:}} test
!! wikitext
{{#iferror:<strong class="error">Expression error.</strong>|yes|no}}
!! html
<p>yes
</p>
!! end

!! test
Basic {{#rel2abs:}} test
!! wikitext
{{#rel2abs: /quok | Help:Foo/bar/baz }}

{{#rel2abs: ./quok | Help:Foo/bar/baz }}

{{#rel2abs: ../quok | Help:Foo/bar/baz }}

{{#rel2abs: ../. | Help:Foo/bar/baz }}

{{#rel2abs: ../quok/. | Help:Foo/bar/baz }}

{{#rel2abs: ../../quok | Help:Foo/bar/baz }}

{{#rel2abs: ../../../quok | Help:Foo/bar/baz }}

{{#rel2abs: ../../../../quok | Help:Foo/bar/baz }}
!! html
<p>Help:Foo/bar/baz/quok
</p><p>Help:Foo/bar/baz/quok
</p><p>Help:Foo/bar/quok
</p><p>Help:Foo/bar
</p><p>Help:Foo/bar/quok
</p><p>Help:Foo/quok
</p><p>quok
</p><p><strong class="error">Error: Invalid depth in path: "Help:Foo/bar/baz/../../../../quok" (tried to access a node above the root node)</strong>
</p>
!! end

!! test
Basic {{#rpos:}} test
!! wikitext
{{#rpos:Žmržlina|lina}}

{{#rpos:<nowiki>This is a </nowiki>test|test}}

{{#rpos:Žmržlina}}
!! html
<p>4
</p><p>0
</p><p>-1
</p>
!! end

!! test
Basic {{#sub:}} test
!! wikitext
{{#sub:Icecream|3}}
{{#sub:Icecream|0|3}}
{{#sub:Icecream|-3}}
{{#sub:Icecream|3|3}}
{{#sub:Icecream|3|-3}}
{{#sub:Icecream|-3|2}}
{{#sub:Icecream|3|0}}
{{#sub:Icecream|0|3}}
{{#sub:Icecream|3|-6}}
{{#sub:Žmržlina|3}}
{{#sub:<nowiki>This is a </nowiki>test|1}}
!! html
<p>cream
Ice
eam
cre
cr
ea
cream
Ice
</p><p>žlina
est
</p>
!! end

!! test
Basic {{#count:}} test
!! wikitext
{{#count:ababa|aba}}
!! html
<p>1
</p>
!! end

!! test
Basic {{#replace:}} test
!! wikitext
{{#replace:My_little_home_page|_|<nowiki/> <nowiki/>}}
{{#replace:Žmržlina|ž|z}}
{{#replace:Žmržlina|ž|z|0}}
!! html
<p>My little home page
Žmrzlina
Žmržlina
</p>
!! end

!! test
Basic {{#explode:}} test
!! wikitext
{{#explode:And if you tolerate this| |2}}
{{#explode:String/Functions/Code|/|-1}}
{{#explode:Split%By%Percentage%Signs|%|2}}
{{#explode:And if you tolerate this thing and expect no more| |2|3}}
{{#explode:Žmržlina|ž|1}}
!! html
<p>you
Code
Percentage
you tolerate this thing and expect no more
lina
</p>
!! end

!! test
Basic {{PLURAL:}} test
!! wikitext
{{PLURAL:2|is}} → is
{{PLURAL:0|is|are}} → are
{{PLURAL:1*1|is|are}} → is
{{PLURAL:21 mod 10|is|are}} → are
{{PLURAL:{{#expr:21 mod 10}}|is|are}} → is
{{PLURAL:1|is|are}} → is
{{PLURAL:2|is|are}} → are
{{PLURAL:-1|is|are}} → is
{{PLURAL:-2|is|are}} → are
{{PLURAL:0.5|is|are}} → are
{{PLURAL:1.5|is|are}} → are
{{PLURAL:-0.5|is|are}} → are
{{PLURAL:-1.5|is|are}} → are
!! html
<p>is → is
are → are
is → is
are → are
is → is
is → is
are → are
is → is
are → are
are → are
are → are
are → are
are → are
</p>
!! end